<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computer - Cloud Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'anthropic': {
                            50: '#fef5ee',
                            100: '#fde9d7',
                            200: '#facfae',
                            300: '#f7ae7a',
                            400: '#f38744',
                            500: '#f06820',
                            600: '#e14d16',
                            700: '#bb3914',
                            800: '#952f18',
                            900: '#782916',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #f06820 0%, #e14d16 100%);
        }

        .card {
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .status-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }

        .tab-active {
            border-bottom: 3px solid #f06820;
            color: #f06820;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f9fafb;
        }

        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #f06820;
        }

        /* Toast Animations */
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .toast-enter { animation: slideInRight 0.3s ease-out forwards; }
        .toast-exit { animation: slideOutRight 0.3s ease-in forwards; }
        .toast-card {
            pointer-events: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        .toast-progress { transition: width linear; }
        .toast-icon { flex-shrink: 0; }

        /* Template Cards */
        .template-card {
            transition: all 0.2s ease;
        }
        .template-card:hover {
            transform: translateY(-4px);
        }

        /* Deployment Progress */
        .deployment-log {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
        }
        .deployment-log::-webkit-scrollbar {
            width: 6px;
        }
        .deployment-log::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .deployment-log::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }

        /* Line clamp utility */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <!-- Navigation -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50 backdrop-blur-sm bg-opacity-80">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-anthropic-600 to-anthropic-700 rounded-lg flex items-center justify-center">
                        <span class="text-xl">üíª</span>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-gray-900">
                            Computer
                        </h1>
                        <p class="text-xs text-gray-600">Cloud Console</p>
                    </div>
                </div>

                <!-- Navigation Links -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#" onclick="switchTab('applications'); return false;" class="text-gray-700 hover:text-gray-900 transition text-sm font-medium">Home</a>
                    <a href="#" class="text-gray-700 hover:text-gray-900 transition text-sm font-medium">Pricing</a>
                    <a href="#" class="text-gray-700 hover:text-gray-900 transition text-sm font-medium">Documentation</a>
                    <a href="#" class="text-gray-700 hover:text-gray-900 transition text-sm font-medium">Support</a>
                </div>

                <!-- User Menu -->
                <div class="flex items-center space-x-4">
                    <!-- Dashboard Toggle -->
                    <button onclick="toggleDashboard()" class="p-2 rounded-lg hover:bg-gray-100 transition" title="Toggle Dashboard">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
                        </svg>
                    </button>
                    <!-- Notifications -->
                    <button class="p-2 rounded-lg hover:bg-gray-100 transition">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                    </button>
                    <div class="flex items-center space-x-2 px-3 py-2 bg-gray-100 rounded-lg">
                        <div class="w-8 h-8 bg-gradient-to-br from-anthropic-500 to-anthropic-600 rounded-full flex items-center justify-center text-sm font-bold text-white">
                            D
                        </div>
                        <span class="text-sm font-medium hidden sm:block">Developer</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Stats Grid (collapsible) -->
        <div id="dashboard-stats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 overflow-hidden transition-all duration-300">
            <!-- Active Deployments -->
            <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-anthropic-600 bg-opacity-20 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-anthropic-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path>
                        </svg>
                    </div>
                    <span class="text-2xl font-bold text-green-400" data-stat="deployments">0</span>
                </div>
                <h3 class="text-sm font-medium text-gray-600">Active Deployments</h3>
                <p class="text-xs text-gray-700 mt-1">Running instances</p>
            </div>

            <!-- API Requests -->
            <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-blue-600 bg-opacity-20 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                    </div>
                    <span class="text-2xl font-bold text-gray-900" data-stat="requests">0</span>
                </div>
                <h3 class="text-sm font-medium text-gray-600">API Requests</h3>
                <p class="text-xs text-gray-700 mt-1">This month</p>
            </div>

            <!-- Monthly Cost -->
            <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-green-600 bg-opacity-20 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <span class="text-2xl font-bold text-green-400" data-stat="cost">$0</span>
                </div>
                <h3 class="text-sm font-medium text-gray-600">Monthly Cost</h3>
                <p class="text-xs text-gray-700 mt-1">Est. $90-120/mo</p>
            </div>

            <!-- Uptime -->
            <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-yellow-600 bg-opacity-20 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <span class="text-2xl font-bold text-green-400" data-stat="uptime">0%</span>
                </div>
                <h3 class="text-sm font-medium text-gray-600">Uptime</h3>
                <p class="text-xs text-gray-700 mt-1">Last 30 days</p>
            </div>
        </div>

        <!-- Tabs -->
        <div class="border-b border-gray-200 mb-6">
            <nav class="flex space-x-8">
                <button onclick="switchTab('applications')" id="tab-applications" class="tab-active pb-4 px-1 text-sm font-medium transition">
                    Applications
                </button>
                <button onclick="switchTab('deploy')" id="tab-deploy" class="pb-4 px-1 text-sm font-medium text-gray-600 hover:text-gray-900 transition">
                    Models
                </button>
                <button onclick="switchTab('deployments')" id="tab-deployments" class="pb-4 px-1 text-sm font-medium text-gray-600 hover:text-gray-900 transition">
                    Deployments
                </button>
                <button onclick="switchTab('analytics')" id="tab-analytics" class="pb-4 px-1 text-sm font-medium text-gray-600 hover:text-gray-900 transition">
                    Analytics
                </button>
                <button onclick="switchTab('settings')" id="tab-settings" class="pb-4 px-1 text-sm font-medium text-gray-600 hover:text-gray-900 transition">
                    Settings
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <div id="content-deployments" class="tab-content hidden">
            <div class="space-y-6">
                <!-- Header -->
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-2xl font-bold mb-1">Active Deployments</h3>
                        <p class="text-gray-600">Your running applications and services</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="syncDeploymentStatuses()" class="px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg text-sm font-medium transition flex items-center space-x-2">
                            <span>üîÑ</span>
                            <span>Sync Status</span>
                        </button>
                        <button onclick="loadApplicationDeployments()" class="px-4 py-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg text-sm font-medium transition flex items-center space-x-2">
                            <span>‚Üª</span>
                            <span>Refresh</span>
                        </button>
                    </div>
                </div>

                <!-- Deployments Grid -->
                <div id="template-deployments-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <p class="text-gray-500 col-span-full text-center py-8">No active deployments. Deploy an application to get started.</p>
                </div>
            </div>
        </div>

        <!-- Applications Tab Content -->
        <div id="content-applications" class="tab-content">
            <!-- Step 1: Template Gallery -->
            <div id="applications-step-1" class="space-y-6">
                <div>
                    <h3 class="text-2xl font-bold mb-2">Deploy from Template</h3>
                    <p class="text-gray-600 mb-4">One-click deployment of AI services, games, and development tools</p>

                    <!-- Category Pills -->
                    <div id="category-pills" class="flex flex-wrap gap-2">
                        <button onclick="filterApplications('all')" data-category="all" class="category-pill active px-4 py-2 rounded-full text-sm font-medium transition-all bg-anthropic-600 text-white">
                            All
                        </button>
                        <button onclick="filterApplications('ai_ml')" data-category="ai_ml" class="category-pill px-4 py-2 rounded-full text-sm font-medium transition-all bg-gray-100 text-gray-700 hover:bg-gray-200">
                            ü§ñ AI / ML
                        </button>
                        <button onclick="filterApplications('games')" data-category="games" class="category-pill px-4 py-2 rounded-full text-sm font-medium transition-all bg-gray-100 text-gray-700 hover:bg-gray-200">
                            üéÆ Games
                        </button>
                        <button onclick="filterApplications('development')" data-category="development" class="category-pill px-4 py-2 rounded-full text-sm font-medium transition-all bg-gray-100 text-gray-700 hover:bg-gray-200">
                            üíª Development
                        </button>
                        <button onclick="filterApplications('desktop')" data-category="desktop" class="category-pill px-4 py-2 rounded-full text-sm font-medium transition-all bg-gray-100 text-gray-700 hover:bg-gray-200">
                            üñ•Ô∏è Desktop
                        </button>
                    </div>
                </div>

                <!-- Template Cards Grid -->
                <div id="applications-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <p class="text-gray-600 col-span-full">Loading applications...</p>
                </div>

            </div>

            <!-- Step 2: Configure Template Deployment -->
            <div id="applications-step-2" class="space-y-6 hidden">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <button onclick="backToApplications()" class="text-anthropic-600 hover:text-anthropic-700 text-sm mb-2">‚Üê Back to Applications</button>
                        <h3 id="template-deploy-title" class="text-2xl font-bold mb-2">Configure Deployment</h3>
                        <p id="template-deploy-description" class="text-gray-600">Configure your deployment settings</p>
                    </div>
                </div>

                <form id="template-deploy-form" onsubmit="submitTemplateDeployment(event)" class="space-y-6">
                    <!-- Template Info Card -->
                    <div class="card bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-start space-x-4">
                            <div id="template-deploy-icon" class="text-4xl">ü¶ô</div>
                            <div class="flex-1">
                                <h4 id="template-deploy-name" class="text-lg font-semibold"></h4>
                                <p id="template-deploy-time" class="text-sm text-gray-500"></p>
                                <div id="template-deploy-features" class="mt-3 flex flex-wrap gap-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Deployment Name -->
                    <div class="card bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <h4 class="text-md font-semibold mb-4">Deployment Name</h4>
                        <div>
                            <input id="template-name" type="text" required class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 outline-none transition" placeholder="my-deployment">
                            <p class="text-xs text-gray-500 mt-2">A unique name to identify this deployment</p>
                        </div>
                    </div>

                    <!-- Dynamic Template Parameters -->
                    <div id="template-parameters-container" class="card bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <h4 class="text-md font-semibold mb-4">Template Configuration</h4>
                        <div id="template-parameters" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Parameters will be rendered here -->
                        </div>
                    </div>

                    <!-- Deploy Button -->
                    <button type="submit" id="template-deploy-btn" class="w-full bg-gradient-to-r from-anthropic-600 to-anthropic-700 hover:from-anthropic-700 hover:to-anthropic-800 text-white rounded-lg px-6 py-3 font-medium text-lg transition shadow-lg hover:shadow-xl">
                        üöÄ Deploy Template
                    </button>
                </form>
            </div>

            <!-- Step 3: Deployment Progress -->
            <div id="applications-step-3" class="space-y-6 hidden">
                <div class="text-center py-8">
                    <div id="deployment-progress-icon" class="text-6xl mb-4">üöÄ</div>
                    <h3 id="deployment-progress-title" class="text-2xl font-bold mb-2">Deploying...</h3>
                    <p id="deployment-progress-status" class="text-gray-600 mb-6">Preparing deployment</p>

                    <!-- Progress Bar -->
                    <div class="max-w-md mx-auto mb-8">
                        <div class="bg-gray-200 rounded-full h-3">
                            <div id="deployment-progress-bar" class="bg-anthropic-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <p id="deployment-progress-percent" class="text-sm text-gray-500 mt-2">0%</p>
                    </div>

                    <!-- Log Output -->
                    <div class="max-w-2xl mx-auto text-left">
                        <div class="bg-gray-900 rounded-xl p-4 h-64 overflow-y-auto font-mono text-sm">
                            <div id="deployment-log" class="space-y-1 text-gray-300">
                                <p class="text-gray-500">Waiting for deployment logs...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Deployment Complete -->
            <div id="applications-step-4" class="space-y-6 hidden">
                <div class="text-center py-8">
                    <div class="text-6xl mb-4">‚úÖ</div>
                    <h3 class="text-2xl font-bold mb-2 text-green-600">Deployment Complete!</h3>
                    <p id="deployment-complete-name" class="text-gray-600 mb-8">Your service is now running</p>
                </div>

                <!-- Access Panel -->
                <div class="card bg-white rounded-xl p-6 border border-gray-200 shadow-sm max-w-2xl mx-auto">
                    <h4 class="text-lg font-semibold mb-4">Access Your Service</h4>
                    <div class="space-y-4">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-xs text-gray-500 mb-1">Service URL</p>
                            <div class="flex items-center justify-between">
                                <code id="deployment-access-url" class="text-sm font-mono text-anthropic-600"></code>
                                <button onclick="copyDeploymentUrl()" class="text-anthropic-600 hover:text-anthropic-700 text-sm">Copy</button>
                            </div>
                        </div>
                        <div id="deployment-access-info" class="space-y-2">
                            <!-- Additional access info will be rendered here -->
                        </div>
                    </div>
                    <div class="mt-6 space-y-3">
                        <a id="deployment-open-link" href="#" target="_blank" class="block w-full text-center px-6 py-4 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-xl text-lg font-semibold transition shadow-lg hover:shadow-xl">
                            üöÄ Launch Service
                        </a>
                        <div class="flex space-x-3">
                            <button onclick="backToApplications()" class="flex-1 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg text-sm font-medium transition">
                                Deploy Another
                            </button>
                            <button id="deployment-stop-btn" onclick="stopCurrentDeployment()" class="flex-1 px-4 py-2 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg text-sm font-medium transition">
                                ‚èπ Stop & Remove
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="content-api-keys" class="tab-content hidden">
            <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md mb-6">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-1">API Keys</h3>
                        <p class="text-sm text-gray-600">Manage your API authentication keys</p>
                    </div>
                    <button onclick="generateAPIKey()" class="px-4 py-2 bg-gradient-to-r from-anthropic-600 to-anthropic-700 hover:from-anthropic-700 hover:to-anthropic-800 rounded-lg text-sm font-medium text-white transition">
                        + Generate New Key
                    </button>
                </div>

                <!-- API Key List -->
                <div id="api-keys-list" class="space-y-4">
                    <p class="text-gray-600">Loading API keys...</p>
                </div>
            </div>
        </div>

        <div id="content-analytics" class="tab-content hidden">
            <div class="space-y-6">
                <!-- Usage Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="card bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <p class="text-xs text-gray-700 mb-1">Total Requests (All Time)</p>
                        <p id="analytics-total" class="text-3xl font-bold text-gray-900">0</p>
                    </div>
                    <div class="card bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <p class="text-xs text-gray-700 mb-1">This Month</p>
                        <p id="analytics-this-month" class="text-3xl font-bold text-anthropic-600">0</p>
                    </div>
                    <div class="card bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <p class="text-xs text-gray-700 mb-1">Last Month</p>
                        <p id="analytics-last-month" class="text-3xl font-bold text-gray-600">0</p>
                    </div>
                </div>

                <!-- Usage Chart -->
                <div class="card bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-1">API Requests (Last 30 Days)</h3>
                            <p class="text-sm text-gray-600">Daily request volume</p>
                        </div>
                    </div>
                    <div id="usage-chart" class="h-64 flex items-end justify-between gap-1">
                        <!-- Chart bars will be rendered here -->
                        <p class="text-gray-600 w-full text-center">Loading chart...</p>
                    </div>
                </div>

                <!-- API Key Usage Breakdown -->
                <div class="card bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-1">Usage by API Key</h3>
                            <p class="text-sm text-gray-600">Request distribution across your API keys</p>
                        </div>
                    </div>
                    <div id="key-usage-list" class="space-y-3">
                        <p class="text-gray-600">Loading usage data...</p>
                    </div>
                </div>

                <!-- Deployment Usage -->
                <div class="card bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-1">Usage by Deployment</h3>
                            <p class="text-sm text-gray-600">Requests per deployment</p>
                        </div>
                    </div>
                    <div id="deployment-usage-list" class="space-y-3">
                        <p class="text-gray-600">No deployment usage data yet.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="content-deploy" class="tab-content hidden">
            <!-- Step 1: Select Application -->
            <div id="deploy-step-1" class="space-y-6">
                <div>
                    <h3 class="text-2xl font-bold mb-2">Deploy New Service</h3>
                    <p class="text-gray-600">Choose the AI service you want to deploy</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Text-to-Speech App -->
                    <div onclick="selectApp('tts')" class="card cursor-pointer bg-white border-2 border-anthropic-600 rounded-xl p-8 shadow-sm hover:shadow-md hover:border-anthropic-500">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-anthropic-600 bg-opacity-20 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">üíª</span>
                            </div>
                            <span class="px-2 py-1 bg-green-600 bg-opacity-20 text-green-400 text-xs rounded-full">Popular</span>
                        </div>
                        <h4 class="text-lg font-semibold mb-2">Text-to-Speech</h4>
                        <p class="text-sm text-gray-600 mb-4">Convert text to natural-sounding speech with voice cloning</p>
                        <div class="flex items-center justify-between text-xs text-gray-700">
                            <span>üî• Most Popular</span>
                            <span>From $0.076/hr</span>
                        </div>
                    </div>

                    <!-- Coming Soon Apps -->
                    <div class="card bg-white border-2 border-gray-300 rounded-xl p-8 shadow-sm opacity-50 cursor-not-allowed">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-blue-600 bg-opacity-20 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">üéß</span>
                            </div>
                            <span class="px-2 py-1 bg-gray-600 bg-opacity-20 text-gray-400 text-xs rounded-full">Soon</span>
                        </div>
                        <h4 class="text-lg font-semibold mb-2">Speech-to-Text</h4>
                        <p class="text-sm text-gray-600 mb-4">Transcribe audio to text with high accuracy</p>
                        <div class="flex items-center justify-between text-xs text-gray-700">
                            <span>Coming Soon</span>
                        </div>
                    </div>

                    <div class="card bg-white border-2 border-gray-300 rounded-xl p-8 shadow-sm opacity-50 cursor-not-allowed">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-yellow-600 bg-opacity-20 rounded-lg flex items-center justify-center">
                                <span class="text-2xl">üó£Ô∏è</span>
                            </div>
                            <span class="px-2 py-1 bg-gray-600 bg-opacity-20 text-gray-400 text-xs rounded-full">Soon</span>
                        </div>
                        <h4 class="text-lg font-semibold mb-2">Voice Cloning</h4>
                        <p class="text-sm text-gray-600 mb-4">Clone any voice from a short audio sample</p>
                        <div class="flex items-center justify-between text-xs text-gray-700">
                            <span>Coming Soon</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Configure Server -->
            <div id="deploy-step-2" class="space-y-6 hidden">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <button onclick="backToAppSelect()" class="text-anthropic-600 hover:text-anthropic-700 text-sm mb-2">‚Üê Back to app selection</button>
                        <h3 class="text-2xl font-bold mb-2">Configure Text-to-Speech Server</h3>
                        <p class="text-gray-600">Choose your GPU and deployment settings</p>
                    </div>
                </div>

                <form onsubmit="deployServer(event)" class="space-y-6">
                    <!-- Server Name -->
                    <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                        <label class="block text-sm font-medium mb-2">Server Name</label>
                        <input id="server-name" type="text" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="my-tts-server">
                        <p class="text-xs text-gray-700 mt-2">Choose a unique name for your deployment</p>
                    </div>

                    <!-- GPU Selection -->
                    <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">Select GPU</label>
                                <p class="text-xs text-gray-700">Choose based on your performance and budget needs</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input id="use-spot" type="checkbox" checked class="w-4 h-4 text-anthropic-600 bg-white border-gray-300 rounded focus:ring-anthropic-600">
                                <label class="text-sm text-gray-800">Spot instances <span class="text-green-400">(60-75% off)</span></label>
                            </div>
                        </div>

                        <div id="gpu-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- GPU cards will be loaded here -->
                            <p class="text-gray-600">Loading GPUs...</p>
                        </div>
                    </div>

                    <!-- Deployment Type -->
                    <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                        <label class="block text-sm font-medium mb-4">Deployment Type</label>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="card cursor-pointer bg-gray-50 border-2 border-anthropic-600 rounded-lg p-4">
                                <input type="radio" name="type" value="raw_compute" checked class="sr-only">
                                <div class="text-center">
                                    <p class="font-medium mb-1">Raw Compute</p>
                                    <p class="text-xs text-gray-600">Full SSH access, maximum control</p>
                                    <p class="text-xs text-green-400 mt-2">Cheapest option</p>
                                </div>
                            </label>
                            <label class="card cursor-pointer bg-gray-50 border-2 border-gray-300 rounded-lg p-4 hover:border-gray-400">
                                <input type="radio" name="type" value="serverless" class="sr-only">
                                <div class="text-center">
                                    <p class="font-medium mb-1">Serverless</p>
                                    <p class="text-xs text-gray-600">Auto-scaling, managed infrastructure</p>
                                    <p class="text-xs text-yellow-400 mt-2">Coming soon</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Deploy Button -->
                    <button type="submit" class="w-full bg-gradient-to-r from-anthropic-600 to-anthropic-700 hover:from-anthropic-700 hover:to-anthropic-800 text-white rounded-lg px-6 py-3 font-medium text-lg transition shadow-lg hover:shadow-xl">
                        üöÄ Deploy Server
                    </button>
                </form>
            </div>
        </div>

        <div id="content-settings" class="tab-content hidden">
            <div class="space-y-6">
                <!-- Account Settings -->
                <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-1">Account Settings</h3>
                            <p class="text-sm text-gray-600">Manage your account information</p>
                        </div>
                        <span id="account-plan-badge" class="px-3 py-1 bg-anthropic-600 bg-opacity-20 text-anthropic-600 text-sm font-medium rounded-full">Professional</span>
                    </div>

                    <form id="account-form" onsubmit="saveAccountSettings(event)" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Name</label>
                                <input id="settings-name" type="text" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="Your name">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Email</label>
                                <input id="settings-email" type="email" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="your@email.com">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Company (Optional)</label>
                            <input id="settings-company" type="text" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="Your company">
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" class="px-4 py-2 bg-gradient-to-r from-anthropic-600 to-anthropic-700 hover:from-anthropic-700 hover:to-anthropic-800 rounded-lg text-sm font-medium text-white transition">
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Billing Summary -->
                <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-1">Billing</h3>
                            <p class="text-sm text-gray-600">Your usage and billing information</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-xs text-gray-700 mb-1">Current Month</p>
                            <p id="billing-current" class="text-2xl font-bold text-gray-900">$0.00</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-xs text-gray-700 mb-1">Last Month</p>
                            <p id="billing-last" class="text-2xl font-bold text-gray-600">$0.00</p>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-xs text-gray-700 mb-1">Payment Method</p>
                            <p id="billing-method" class="text-sm font-medium text-gray-800">No payment method</p>
                        </div>
                    </div>

                    <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                        <p class="text-sm text-gray-600">Need to update billing details?</p>
                        <button class="text-anthropic-600 hover:text-anthropic-700 text-sm font-medium">Contact Support ‚Üí</button>
                    </div>
                </div>

                <!-- Notification Preferences -->
                <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-1">Notifications</h3>
                            <p class="text-sm text-gray-600">Control how you receive alerts</p>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-center justify-between py-3 border-b border-gray-100">
                            <div>
                                <p class="text-sm font-medium">Email Notifications</p>
                                <p class="text-xs text-gray-600">Receive notifications via email</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="notif-email" class="sr-only peer" onchange="updateNotification('email_notifications', this.checked)">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-anthropic-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-anthropic-600"></div>
                            </label>
                        </div>

                        <div class="flex items-center justify-between py-3 border-b border-gray-100">
                            <div>
                                <p class="text-sm font-medium">Deployment Started</p>
                                <p class="text-xs text-gray-600">Alert when a new deployment starts</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="notif-started" class="sr-only peer" onchange="updateNotification('deployment_started', this.checked)">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-anthropic-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-anthropic-600"></div>
                            </label>
                        </div>

                        <div class="flex items-center justify-between py-3 border-b border-gray-100">
                            <div>
                                <p class="text-sm font-medium">Deployment Stopped</p>
                                <p class="text-xs text-gray-600">Alert when a deployment stops</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="notif-stopped" class="sr-only peer" onchange="updateNotification('deployment_stopped', this.checked)">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-anthropic-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-anthropic-600"></div>
                            </label>
                        </div>

                        <div class="flex items-center justify-between py-3 border-b border-gray-100">
                            <div>
                                <p class="text-sm font-medium">Deployment Failed</p>
                                <p class="text-xs text-gray-600">Alert when a deployment fails</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="notif-failed" class="sr-only peer" onchange="updateNotification('deployment_failed', this.checked)">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-anthropic-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-anthropic-600"></div>
                            </label>
                        </div>

                        <div class="flex items-center justify-between py-3 border-b border-gray-100">
                            <div>
                                <p class="text-sm font-medium">Usage Alerts</p>
                                <p class="text-xs text-gray-600">Alert when approaching usage limits</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="notif-usage" class="sr-only peer" onchange="updateNotification('usage_alerts', this.checked)">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-anthropic-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-anthropic-600"></div>
                            </label>
                        </div>

                        <div class="flex items-center justify-between py-3">
                            <div>
                                <p class="text-sm font-medium">Weekly Summary</p>
                                <p class="text-xs text-gray-600">Receive a weekly usage summary</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="notif-weekly" class="sr-only peer" onchange="updateNotification('weekly_summary', this.checked)">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-anthropic-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-anthropic-600"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Webhooks -->
                <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-1">Webhooks</h3>
                            <p class="text-sm text-gray-600">Receive real-time event notifications</p>
                        </div>
                        <button onclick="showAddWebhookModal()" class="px-4 py-2 bg-gradient-to-r from-anthropic-600 to-anthropic-700 hover:from-anthropic-700 hover:to-anthropic-800 rounded-lg text-sm font-medium text-white transition">
                            + Add Webhook
                        </button>
                    </div>

                    <div id="webhooks-list" class="space-y-4">
                        <p class="text-gray-600">No webhooks configured. Add a webhook to receive event notifications.</p>
                    </div>
                </div>

                <!-- Usage Limits -->
                <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-1">Usage Limits</h3>
                            <p class="text-sm text-gray-600">Configure rate limits and usage thresholds</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="limits-enabled" class="sr-only peer" onchange="toggleLimits(this.checked)">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-anthropic-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-anthropic-600"></div>
                            <span class="ml-2 text-sm text-gray-700">Enabled</span>
                        </label>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">API Requests per Minute</label>
                            <input id="limit-rpm" type="number" min="1" max="1000" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="60">
                            <p class="text-xs text-gray-600 mt-1">Rate limit per API key</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">API Requests per Day</label>
                            <input id="limit-rpd" type="number" min="100" max="1000000" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="10000">
                            <p class="text-xs text-gray-600 mt-1">Daily quota per API key</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Max Concurrent Deployments</label>
                            <input id="limit-deployments" type="number" min="1" max="50" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="5">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Max API Keys</label>
                            <input id="limit-keys" type="number" min="1" max="100" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="10">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Cost Alert Threshold ($)</label>
                            <input id="limit-cost-alert" type="number" min="1" step="0.01" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="100.00">
                            <p class="text-xs text-gray-600 mt-1">Alert when monthly cost exceeds this</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Auto-Stop Threshold ($)</label>
                            <input id="limit-auto-stop" type="number" min="1" step="0.01" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="500.00">
                            <p class="text-xs text-gray-600 mt-1">Auto-stop deployments when cost exceeds this</p>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button onclick="saveLimits()" class="px-4 py-2 bg-gradient-to-r from-anthropic-600 to-anthropic-700 hover:from-anthropic-700 hover:to-anthropic-800 rounded-lg text-sm font-medium text-white transition">
                            Save Limits
                        </button>
                    </div>
                </div>

                <!-- Danger Zone -->
                <div class="card bg-white rounded-xl p-8 border-2 border-red-200 shadow-sm hover:shadow-md">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-red-700">Danger Zone</h3>
                            <p class="text-sm text-red-600">Irreversible and destructive actions</p>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200">
                            <div>
                                <p class="text-sm font-medium text-gray-900">Reset Usage Statistics</p>
                                <p class="text-xs text-gray-600">Clear all API usage data and analytics</p>
                            </div>
                            <button onclick="dangerResetUsage()" class="px-4 py-2 bg-white border-2 border-red-500 text-red-600 hover:bg-red-50 rounded-lg text-sm font-medium transition">
                                Reset Stats
                            </button>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200">
                            <div>
                                <p class="text-sm font-medium text-gray-900">Revoke All API Keys</p>
                                <p class="text-xs text-gray-600">Permanently delete all generated API keys</p>
                            </div>
                            <button onclick="dangerRevokeAllKeys()" class="px-4 py-2 bg-white border-2 border-red-500 text-red-600 hover:bg-red-50 rounded-lg text-sm font-medium transition">
                                Revoke All
                            </button>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-red-50 rounded-lg border border-red-200">
                            <div>
                                <p class="text-sm font-medium text-gray-900">Stop All Deployments</p>
                                <p class="text-xs text-gray-600">Immediately stop all running deployments</p>
                            </div>
                            <button onclick="dangerStopAllDeployments()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition">
                                Stop All
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        const API_BASE = '';

        // ============================================================================
        // TOAST NOTIFICATION SYSTEM
        // ============================================================================
        class ToastManager {
            constructor() {
                this.toasts = new Map();
                this.container = document.getElementById('toast-container');
                this.maxToasts = 5;

                // Keyboard support
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.toasts.size > 0) {
                        const toastIds = Array.from(this.toasts.keys());
                        this.dismiss(toastIds[toastIds.length - 1]);
                    }
                });
            }

            show(options) {
                const {
                    type = 'info',
                    title,
                    description = '',
                    duration = 5000,
                    action = null,
                    dismissible = true
                } = options;

                // Enforce max toasts limit
                if (this.toasts.size >= this.maxToasts) {
                    const oldestId = Array.from(this.toasts.keys())[0];
                    this.dismiss(oldestId);
                }

                const toastId = this.generateId();
                const toast = this.createToastElement(toastId, type, title, description, action, dismissible, duration);

                this.container.appendChild(toast);
                this.toasts.set(toastId, { element: toast, timer: null });

                // Trigger animation
                setTimeout(() => toast.classList.add('toast-enter'), 10);

                // Auto-dismiss
                if (duration > 0) {
                    const timer = setTimeout(() => this.dismiss(toastId), duration);
                    this.toasts.get(toastId).timer = timer;

                    // Progress bar animation
                    const progressBar = toast.querySelector('.toast-progress');
                    if (progressBar) {
                        progressBar.style.width = '0%';
                        progressBar.style.transitionDuration = `${duration}ms`;
                    }
                }

                return toastId;
            }

            createToastElement(id, type, title, description, action, dismissible, duration) {
                const toast = document.createElement('div');
                toast.id = `toast-${id}`;
                toast.className = 'toast-card bg-white rounded-lg border-2 p-4 mb-3 relative overflow-hidden';
                toast.setAttribute('role', 'alert');
                toast.setAttribute('aria-live', 'assertive');
                toast.setAttribute('aria-atomic', 'true');

                const typeConfig = {
                    success: {
                        borderColor: 'border-green-500',
                        icon: '‚úì',
                        iconBg: 'bg-green-100',
                        iconColor: 'text-green-600',
                        progressColor: 'bg-green-500'
                    },
                    error: {
                        borderColor: 'border-red-500',
                        icon: '‚úï',
                        iconBg: 'bg-red-100',
                        iconColor: 'text-red-600',
                        progressColor: 'bg-red-500'
                    },
                    warning: {
                        borderColor: 'border-yellow-500',
                        icon: '‚ö†',
                        iconBg: 'bg-yellow-100',
                        iconColor: 'text-yellow-600',
                        progressColor: 'bg-yellow-500'
                    },
                    info: {
                        borderColor: 'border-blue-500',
                        icon: '‚Ñπ',
                        iconBg: 'bg-blue-100',
                        iconColor: 'text-blue-600',
                        progressColor: 'bg-blue-500'
                    }
                };

                const config = typeConfig[type];
                toast.classList.add(config.borderColor);

                const truncatedDesc = description.length > 150
                    ? description.substring(0, 150) + '...'
                    : description;

                const content = `
                    <div class="flex items-start space-x-3">
                        <div class="toast-icon w-8 h-8 ${config.iconBg} ${config.iconColor} rounded-full flex items-center justify-center font-bold text-sm flex-shrink-0">
                            ${config.icon}
                        </div>

                        <div class="flex-1 min-w-0">
                            <h4 class="text-sm font-semibold text-gray-900 mb-1">${this.escapeHtml(title)}</h4>
                            ${truncatedDesc ? `<p class="text-sm text-gray-600 leading-relaxed">${this.escapeHtml(truncatedDesc)}</p>` : ''}

                            ${action ? `
                                <button
                                    onclick="toastManager.handleAction('${id}', ${action.onClick})"
                                    class="mt-2 text-sm font-medium text-anthropic-600 hover:text-anthropic-700 transition"
                                >
                                    ${this.escapeHtml(action.label)}
                                </button>
                            ` : ''}
                        </div>

                        ${dismissible ? `
                            <button
                                onclick="toastManager.dismiss('${id}')"
                                class="flex-shrink-0 text-gray-400 hover:text-gray-600 transition ml-2"
                                aria-label="Dismiss notification"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        ` : ''}
                    </div>

                    ${duration > 0 ? `
                        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gray-100">
                            <div class="toast-progress h-full ${config.progressColor}" style="width: 100%;"></div>
                        </div>
                    ` : ''}
                `;

                toast.innerHTML = content;
                return toast;
            }

            dismiss(toastId) {
                const toastData = this.toasts.get(toastId);
                if (!toastData) return;

                const { element, timer } = toastData;

                if (timer) clearTimeout(timer);

                element.classList.remove('toast-enter');
                element.classList.add('toast-exit');

                setTimeout(() => {
                    element.remove();
                    this.toasts.delete(toastId);
                }, 300);
            }

            handleAction(toastId, actionFn) {
                if (typeof actionFn === 'function') {
                    actionFn();
                }
                this.dismiss(toastId);
            }

            dismissAll() {
                this.toasts.forEach((_, id) => this.dismiss(id));
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            success(title, description = '', options = {}) {
                return this.show({ type: 'success', title, description, ...options });
            }

            error(title, description = '', options = {}) {
                return this.show({ type: 'error', title, description, ...options });
            }

            warning(title, description = '', options = {}) {
                return this.show({ type: 'warning', title, description, ...options });
            }

            info(title, description = '', options = {}) {
                return this.show({ type: 'info', title, description, ...options });
            }
        }

        // Initialize global toast manager
        const toastManager = new ToastManager();

        // Logs modal functions
        function showLogsModal(logs) {
            document.getElementById('logs-content').textContent = logs;
            document.getElementById('logs-modal').classList.remove('hidden');
        }

        function closeLogsModal() {
            document.getElementById('logs-modal').classList.add('hidden');
        }

        function copyLogs() {
            const logs = document.getElementById('logs-content').textContent;
            navigator.clipboard.writeText(logs);
            toastManager.success('Copied!', 'Logs copied to clipboard.', { duration: 2000 });
        }

        // ============================================================================
        // TAB SWITCHING
        // ============================================================================
        function switchTab(tabName) {
            // Hide all content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Remove active state from all tabs
            document.querySelectorAll('nav button').forEach(tab => {
                tab.classList.remove('tab-active');
                tab.classList.add('text-gray-600');
            });

            // Show selected content
            document.getElementById('content-' + tabName).classList.remove('hidden');

            // Add active state to selected tab
            const activeTab = document.getElementById('tab-' + tabName);
            activeTab.classList.add('tab-active');
            activeTab.classList.remove('text-gray-600');

            // Load data for this tab
            if (tabName === 'applications') {
                loadTemplates();
                loadApplicationDeployments();
            } else if (tabName === 'deployments') {
                loadDeployments();
            } else if (tabName === 'api-keys') {
                loadAPIKeys();
            } else if (tabName === 'analytics') {
                loadAnalytics();
            } else if (tabName === 'deploy') {
                loadGPUOptions();
            } else if (tabName === 'settings') {
                loadSettings();
            }
        }

        // ============================================================================
        // LOAD STATS
        // ============================================================================
        async function loadStats() {
            try {
                const response = await fetch(API_BASE + '/api/stats');
                const data = await response.json();

                // Update stats cards
                document.querySelector('[data-stat="deployments"]').textContent = data.active_deployments;
                document.querySelector('[data-stat="requests"]').textContent = formatNumber(data.api_requests);
                document.querySelector('[data-stat="cost"]').textContent = '$' + data.monthly_cost;
                document.querySelector('[data-stat="uptime"]').textContent = data.uptime + '%';
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // ============================================================================
        // LOAD DEPLOYMENTS
        // ============================================================================
        async function loadDeployments() {
            try {
                const response = await fetch(API_BASE + '/api/deployments');
                const data = await response.json();

                const container = document.getElementById('deployments-list');
                if (!data.deployments || data.deployments.length === 0) {
                    container.innerHTML = '<p class="text-gray-600">No deployments yet. Deploy your first server!</p>';
                    return;
                }

                container.innerHTML = data.deployments.map(d => createDeploymentCard(d)).join('');
            } catch (error) {
                console.error('Error loading deployments:', error);
            }
        }

        function createDeploymentCard(deployment) {
            const statusColors = {
                'running': 'green',
                'stopped': 'red',
                'unknown': 'yellow'
            };
            const color = statusColors[deployment.status] || 'gray';

            return `
                <div class="card bg-white rounded-xl p-8 border border-gray-200 shadow-sm hover:shadow-md">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-${color}-500 rounded-full ${deployment.status === 'running' ? 'status-dot' : ''}"></div>
                                <span class="text-sm font-medium text-${color}-400">${deployment.status}</span>
                            </div>
                            <h3 class="text-lg font-semibold">${deployment.name}</h3>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="showMetrics('${deployment.id}', '${deployment.name}')" class="px-4 py-2 bg-white border-2 border-anthropic-500 hover:bg-anthropic-50 text-anthropic-600 rounded-lg text-sm font-medium transition">
                                Metrics
                            </button>
                            <button onclick="viewLogs('${deployment.id}')" class="px-4 py-2 bg-white border-2 border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg text-sm font-medium transition">
                                View Logs
                            </button>
                            <button onclick="stopDeployment('${deployment.id}')" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition">
                                Stop
                            </button>
                        </div>
                    </div>

                    <!-- Quick Metrics Row -->
                    <div id="quick-metrics-${deployment.id}" class="grid grid-cols-4 gap-3 mb-4 p-3 bg-gray-50 rounded-lg">
                        <div class="text-center">
                            <p class="text-xs text-gray-600">CPU</p>
                            <p class="text-sm font-semibold text-gray-900" data-metric="cpu">--</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-600">Memory</p>
                            <p class="text-sm font-semibold text-gray-900" data-metric="memory">--</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-600">Latency</p>
                            <p class="text-sm font-semibold text-gray-900" data-metric="latency">--</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-600">Req/min</p>
                            <p class="text-sm font-semibold text-gray-900" data-metric="rpm">--</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <p class="text-xs text-gray-700 mb-1">Endpoint</p>
                            <p class="text-sm font-mono text-gray-800">${deployment.endpoint}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-700 mb-1">GPU</p>
                            <p class="text-sm text-gray-800">${deployment.gpu}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-700 mb-1">Cost</p>
                            <p class="text-sm text-green-400">${deployment.cost}</p>
                        </div>
                    </div>

                    ${deployment.endpoint !== 'N/A' ? `
                    <div class="bg-gray-50 rounded-lg p-4 font-mono text-xs">
                        <p class="text-gray-600 mb-2">API Usage:</p>
                        <code class="text-gray-800">curl -X POST https://${deployment.endpoint}/generate \\
  -H "X-API-Key: YOUR_API_KEY" \\
  -F "text=Hello world" \\
  --output speech.wav</code>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // Load quick metrics for all deployments
        async function loadQuickMetrics(deploymentId) {
            try {
                const response = await fetch(API_BASE + `/api/deployments/${deploymentId}/metrics`);
                const metrics = await response.json();

                const container = document.getElementById(`quick-metrics-${deploymentId}`);
                if (container) {
                    container.querySelector('[data-metric="cpu"]').textContent = metrics.cpu_percent + '%';
                    container.querySelector('[data-metric="memory"]').textContent = metrics.memory_percent + '%';
                    container.querySelector('[data-metric="latency"]').textContent = metrics.avg_latency_ms + 'ms';
                    container.querySelector('[data-metric="rpm"]').textContent = metrics.requests_per_minute;

                    // Color code based on values
                    const cpuEl = container.querySelector('[data-metric="cpu"]');
                    if (metrics.cpu_percent > 80) cpuEl.classList.add('text-red-600');
                    else if (metrics.cpu_percent > 60) cpuEl.classList.add('text-yellow-600');
                    else cpuEl.classList.add('text-green-600');

                    const memEl = container.querySelector('[data-metric="memory"]');
                    if (metrics.memory_percent > 85) memEl.classList.add('text-red-600');
                    else if (metrics.memory_percent > 70) memEl.classList.add('text-yellow-600');
                    else memEl.classList.add('text-green-600');
                }
            } catch (error) {
                console.error('Error loading metrics for', deploymentId, error);
            }
        }

        async function stopDeployment(deploymentId) {
            if (!confirm('Are you sure you want to stop this deployment?')) return;

            try {
                const response = await fetch(API_BASE + '/api/deployments/stop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ deployment_id: deploymentId })
                });

                const data = await response.json();

                // Check if request was successful
                if (!response.ok) {
                    throw new Error(data.detail || data.message || 'Failed to stop deployment');
                }

                toastManager.success('Deployment Stopped', data.message || 'The deployment has been stopped successfully.');
                loadDeployments();
                loadStats();
            } catch (error) {
                console.error('Error stopping deployment:', error);
                toastManager.error('Stop Failed', 'Could not stop: ' + (error.message || 'Unknown error'));
            }
        }

        async function viewLogs(deploymentId) {
            try {
                const response = await fetch(API_BASE + `/api/deployments/${deploymentId}/logs`);
                const data = await response.json();
                showLogsModal(data.logs);
            } catch (error) {
                console.error('Error fetching logs:', error);
                toastManager.error('Logs Unavailable', 'Unable to fetch deployment logs.');
            }
        }

        // ============================================================================
        // LOAD API KEYS
        // ============================================================================
        async function loadAPIKeys() {
            try {
                const response = await fetch(API_BASE + '/api/keys');
                const data = await response.json();

                const container = document.getElementById('api-keys-list');
                if (!data.keys || data.keys.length === 0) {
                    container.innerHTML = '<p class="text-gray-600">No API keys yet. Generate your first key!</p>';
                    return;
                }

                container.innerHTML = data.keys.map(key => createAPIKeyCard(key)).join('');
            } catch (error) {
                console.error('Error loading API keys:', error);
            }
        }

        function createAPIKeyCard(key) {
            const lastUsedText = key.last_used
                ? `Last used: ${new Date(key.last_used).toLocaleString()}`
                : 'Never used';
            const requestCount = key.request_count || 0;

            // Calculate usage status
            let usageStatus = 'Low';
            let usageColor = 'green';
            if (requestCount > 5000) {
                usageStatus = 'High';
                usageColor = 'red';
            } else if (requestCount > 1000) {
                usageStatus = 'Medium';
                usageColor = 'yellow';
            }

            return `
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div>
                                <p class="text-sm font-medium text-gray-900">${key.name}</p>
                                <p class="text-xs text-gray-700">Created ${new Date(key.created_at).toLocaleDateString()}</p>
                            </div>
                            <span class="px-2 py-0.5 bg-${usageColor}-100 text-${usageColor}-700 text-xs rounded-full">${usageStatus} usage</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="simulateAPIUsage('${key.id}')" class="text-sm text-anthropic-600 hover:text-anthropic-700" title="Simulate API request">
                                + Record Request
                            </button>
                            <button onclick="revokeKey('${key.id}')" class="text-sm text-red-600 hover:text-red-700">Revoke</button>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 mb-3">
                        <code class="flex-1 bg-white border-2 border-gray-300 px-3 py-2 rounded text-sm font-mono text-gray-800 truncate">${key.key}</code>
                        <button onclick="copyToClipboard('${key.key}')" class="px-3 py-2 bg-white border-2 border-gray-300 hover:bg-gray-50 text-gray-700 rounded text-sm transition flex-shrink-0">Copy</button>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4 text-xs">
                            <span class="text-gray-600">${lastUsedText}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="px-2 py-1 bg-anthropic-100 text-anthropic-700 rounded text-xs font-medium">${formatNumber(requestCount)} requests</span>
                        </div>
                    </div>
                    ${key.description ? `<p class="text-xs text-gray-500 mt-2 italic">${key.description}</p>` : ''}
                </div>
            `;
        }

        function generateAPIKey() {
            document.getElementById('api-key-modal').classList.remove('hidden');
        }

        function closeAPIKeyModal() {
            document.getElementById('api-key-modal').classList.add('hidden');
            document.getElementById('api-key-form').reset();
        }

        async function createAPIKey(event) {
            event.preventDefault();

            const name = document.getElementById('new-key-name').value.trim();
            const description = document.getElementById('new-key-description').value.trim();

            if (!name) {
                toastManager.warning('Name Required', 'Please enter a name for this API key.');
                return;
            }

            try {
                const response = await fetch(API_BASE + '/api/keys/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, description })
                });

                const data = await response.json();

                if (data.success) {
                    toastManager.success('API Key Created', 'Your new API key has been generated. Copy it now - you won\'t see it again!', {duration: 8000});
                    closeAPIKeyModal();
                    loadAPIKeys();

                    // Copy the new key to clipboard automatically
                    navigator.clipboard.writeText(data.key.key);
                    toastManager.info('Copied to Clipboard', 'The new API key has been copied to your clipboard.', {duration: 3000});
                }
            } catch (error) {
                console.error('Error generating API key:', error);
                toastManager.error('Generation Failed', 'Could not generate API key. Please try again.');
            }
        }

        async function revokeKey(keyId) {
            if (!confirm('Are you sure you want to revoke this API key?')) return;

            try {
                const response = await fetch(API_BASE + `/api/keys/${keyId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                toastManager.success('Key Revoked', data.message);
                loadAPIKeys();
            } catch (error) {
                console.error('Error revoking key:', error);
                toastManager.error('Revocation Failed', 'Could not revoke the API key.');
            }
        }

        // ============================================================================
        // APP SELECTION & GPU OPTIONS
        // ============================================================================
        let selectedGPU = null;

        function selectApp(appType) {
            // Hide app selection, show config
            document.getElementById('deploy-step-1').classList.add('hidden');
            document.getElementById('deploy-step-2').classList.remove('hidden');

            // Load GPUs
            loadGPUCards();
        }

        function backToAppSelect() {
            // Show app selection, hide config
            document.getElementById('deploy-step-1').classList.remove('hidden');
            document.getElementById('deploy-step-2').classList.add('hidden');
            selectedGPU = null;
        }

        async function loadGPUCards() {
            const container = document.getElementById('gpu-cards');

            try {
                const response = await fetch(API_BASE + '/api/gpus');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const previousSelection = selectedGPU;

                container.innerHTML = data.gpus.map(gpu => createGPUCard(gpu)).join('');

                if (previousSelection) {
                    selectedGPU = previousSelection;
                    updateGPUSelectionUI();
                }
            } catch (error) {
                console.error('Error loading GPU options:', error);
                showGPULoadError(error);
            }
        }

        function createGPUCard(gpu) {
            const isSelected = selectedGPU === gpu.name;
            const borderClass = isSelected ? 'border-anthropic-600' : 'border-gray-300 hover:border-anthropic-500';

            // Determine tier badge
            let tierBadge = '';
            let tierColor = '';
            if (gpu.spot_price < 0.15) {
                tierBadge = 'Budget';
                tierColor = 'bg-green-600';
            } else if (gpu.spot_price < 0.30) {
                tierBadge = 'Performance';
                tierColor = 'bg-blue-600';
            } else if (gpu.spot_price < 0.70) {
                tierBadge = 'High-End';
                tierColor = 'bg-anthropic-600';
            } else {
                tierBadge = 'Premium';
                tierColor = 'bg-yellow-600';
            }

            return `
                <div onclick="selectGPU('${gpu.name}')" class="card cursor-pointer bg-gray-50 border-2 ${borderClass} rounded-lg p-4 transition">
                    <div class="flex items-center justify-between mb-3">
                        <span class="px-2 py-1 ${tierColor} bg-opacity-20 text-xs rounded-full">${tierBadge}</span>
                        ${isSelected ? '<span class="text-anthropic-600">‚úì</span>' : ''}
                    </div>

                    <h4 class="font-semibold mb-2">${gpu.display_name}</h4>

                    <div class="space-y-2 mb-4">
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-gray-700">Memory</span>
                            <span class="text-gray-800">${gpu.memory}</span>
                        </div>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-gray-700">Spot Price</span>
                            <span class="text-green-400 font-medium">$${gpu.spot_price.toFixed(3)}/hr</span>
                        </div>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-gray-700">Instance Price</span>
                            <span class="text-gray-600">$${gpu.instance_price.toFixed(3)}/hr</span>
                        </div>
                    </div>

                    <div class="pt-3 border-t border-gray-300">
                        <p class="text-xs text-gray-700">~${Math.round(gpu.spot_price * 24 * 30)}/mo with spot</p>
                    </div>
                </div>
            `;
        }

        function selectGPU(gpuName) {
            selectedGPU = gpuName;
            updateGPUSelectionUI();
        }

        function updateGPUSelectionUI() {
            const allCards = document.querySelectorAll('#gpu-cards > div[onclick^="selectGPU"]');
            allCards.forEach(card => {
                const gpuName = card.getAttribute('onclick').match(/selectGPU\('([^']+)'\)/)?.[1];

                if (gpuName === selectedGPU) {
                    card.className = card.className.replace('border-gray-300', 'border-anthropic-600');

                    if (!card.querySelector('.selected-checkmark')) {
                        const checkmark = document.createElement('span');
                        checkmark.className = 'text-anthropic-600 selected-checkmark font-bold text-xl';
                        checkmark.textContent = '‚úì';
                        const header = card.querySelector('.flex.items-center.justify-between.mb-3');
                        if (header) header.appendChild(checkmark);
                    }
                } else {
                    card.className = card.className.replace('border-anthropic-600', 'border-gray-300');
                    const checkmark = card.querySelector('.selected-checkmark');
                    if (checkmark) checkmark.remove();
                }
            });
        }

        function showGPULoadError(error) {
            const container = document.getElementById('gpu-cards');

            container.innerHTML = `
                <div class="col-span-full bg-red-50 border-2 border-red-500 rounded-lg p-6 text-center">
                    <p class="text-red-600 font-medium mb-2">‚ö†Ô∏è Unable to load GPU options</p>
                    <p class="text-sm text-red-500 mb-4">${error.message || 'Please try again later'}</p>
                    <button onclick="loadGPUCards()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition">
                        üîÑ Retry
                    </button>
                </div>
            `;

            toastManager.error(
                'Failed to load GPUs',
                'Could not connect to GPU availability service. Please check your connection and try again.',
                { duration: 10000 }
            );
        }

        async function loadGPUOptions() {
            // This is called when switching to deploy tab
            // Check if we're on step 2, if so load GPU cards
            if (!document.getElementById('deploy-step-2').classList.contains('hidden')) {
                loadGPUCards();
            }
        }

        // ============================================================================
        // DEPLOY SERVER
        // ============================================================================
        async function deployServer(event) {
            event.preventDefault();

            const name = document.getElementById('server-name').value.trim();
            const deploymentType = document.querySelector('input[name="type"]:checked').value;
            const useSpot = document.getElementById('use-spot').checked;

            if (!name) {
                toastManager.warning('Name Required', 'Please enter a server name before deploying.');
                document.getElementById('server-name').focus();
                return;
            }

            if (name.length < 3) {
                toastManager.warning('Invalid Name', 'Server name must be at least 3 characters long.');
                document.getElementById('server-name').focus();
                return;
            }

            if (!selectedGPU) {
                toastManager.warning('GPU Required', 'Please select a GPU configuration.');
                return;
            }

            const submitButton = event.target.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = '‚è≥ Deploying...';

            try {
                const response = await fetch(API_BASE + '/api/deployments/deploy', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: name,
                        gpu_type: selectedGPU,
                        deployment_type: deploymentType,
                        use_spot: useSpot
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    const errorMessage = data.detail || data.message || `Server returned ${response.status}`;
                    throw new Error(errorMessage);
                }

                toastManager.success(
                    'Deployment Started',
                    data.message || 'Your server is being deployed.',
                    { duration: 7000 }
                );

                document.getElementById('server-name').value = '';
                selectedGPU = null;
                backToAppSelect();
                switchTab('deployments');
                loadStats();

            } catch (error) {
                console.error('Error deploying server:', error);

                toastManager.error(
                    'Deployment Failed',
                    error.message || 'An unexpected error occurred. Please try again.',
                    { duration: 10000 }
                );

            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = originalText;
            }
        }

        // ============================================================================
        // TEMPLATE DEPLOYMENT SYSTEM
        // ============================================================================
        let applicationsData = [];
        let selectedTemplate = null;
        let deploymentWebSocket = null;
        let currentDeploymentId = null;

        async function loadTemplates() {
            try {
                const response = await fetch(API_BASE + '/api/templates');
                const data = await response.json();
                applicationsData = data.templates || [];
                renderApplicationGrid(applicationsData);
            } catch (error) {
                console.error('Error loading templates:', error);
                document.getElementById('applications-grid').innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <p class="text-red-500">Failed to load applications. Please try again.</p>
                        <button onclick="loadTemplates()" class="mt-4 text-anthropic-600 hover:text-anthropic-700">Retry</button>
                    </div>
                `;
            }
        }

        function filterApplications(category) {
            // Update active pill state
            document.querySelectorAll('.category-pill').forEach(pill => {
                if (pill.dataset.category === category) {
                    pill.classList.add('active', 'bg-anthropic-600', 'text-white');
                    pill.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                } else {
                    pill.classList.remove('active', 'bg-anthropic-600', 'text-white');
                    pill.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                }
            });

            // Filter and render
            if (category === 'all') {
                renderApplicationGrid(applicationsData);
            } else {
                const filtered = applicationsData.filter(t => t.category === category);
                renderApplicationGrid(filtered);
            }
        }

        function renderApplicationGrid(templates) {
            const container = document.getElementById('applications-grid');

            if (!templates || templates.length === 0) {
                container.innerHTML = '<p class="text-gray-600 col-span-full">No applications available.</p>';
                return;
            }

            container.innerHTML = templates.map(template => createTemplateCard(template)).join('');
        }

        function createTemplateCard(template) {
            const colorClasses = {
                purple: 'border-purple-500 hover:border-purple-600',
                orange: 'border-orange-500 hover:border-orange-600',
                green: 'border-green-500 hover:border-green-600',
                amber: 'border-amber-500 hover:border-amber-600',
                blue: 'border-blue-500 hover:border-blue-600',
            };

            const bgColorClasses = {
                purple: 'bg-purple-50',
                orange: 'bg-orange-50',
                green: 'bg-green-50',
                amber: 'bg-amber-50',
                blue: 'bg-blue-50',
            };

            const borderClass = colorClasses[template.color] || 'border-gray-300 hover:border-gray-400';
            const bgClass = bgColorClasses[template.color] || 'bg-gray-50';

            return `
                <div onclick="selectTemplate('${template.id}')" class="card cursor-pointer bg-white border-2 ${borderClass} rounded-xl p-6 shadow-sm hover:shadow-md transition-all">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 ${bgClass} rounded-lg flex items-center justify-center">
                            <span class="text-2xl">${template.icon}</span>
                        </div>
                        <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">${template.category.replace('_', '/')}</span>
                    </div>
                    <h4 class="text-lg font-semibold mb-2">${template.name}</h4>
                    <p class="text-sm text-gray-600 mb-4 line-clamp-2">${template.description}</p>
                    <div class="flex flex-wrap gap-1 mb-4">
                        ${template.features.slice(0, 3).map(f => `<span class="px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded">${f}</span>`).join('')}
                        ${template.features.length > 3 ? `<span class="px-2 py-0.5 bg-gray-100 text-gray-500 text-xs rounded">+${template.features.length - 3} more</span>` : ''}
                    </div>
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span>‚è±Ô∏è ${template.estimated_deploy_time}</span>
                        <span>Port: ${template.default_port}</span>
                    </div>
                </div>
            `;
        }

        async function selectTemplate(templateId) {
            const template = applicationsData.find(t => t.id === templateId);
            if (!template) return;

            selectedTemplate = template;

            // Update the configuration form
            document.getElementById('template-deploy-title').textContent = `Deploy ${template.name}`;
            document.getElementById('template-deploy-description').textContent = template.description;
            document.getElementById('template-deploy-icon').textContent = template.icon;
            document.getElementById('template-deploy-name').textContent = template.name;
            document.getElementById('template-deploy-time').textContent = `Estimated time: ${template.estimated_deploy_time}`;

            // Render features
            const featuresContainer = document.getElementById('template-deploy-features');
            featuresContainer.innerHTML = template.features.map(f =>
                `<span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">${f}</span>`
            ).join('');

            // Render parameters
            renderTemplateParameters(template.parameters);

            // Set default name
            document.getElementById('template-name').value = `${template.id}-${Date.now().toString(36)}`;

            // Show step 2
            document.getElementById('applications-step-1').classList.add('hidden');
            document.getElementById('applications-step-2').classList.remove('hidden');
        }

        function renderTemplateParameters(parameters) {
            const container = document.getElementById('template-parameters');

            if (!parameters || parameters.length === 0) {
                container.innerHTML = '<p class="text-gray-500 col-span-2">No additional configuration required.</p>';
                return;
            }

            container.innerHTML = parameters.map(param => {
                let inputHtml = '';

                if (param.type === 'select') {
                    inputHtml = `
                        <select id="param-${param.name}" ${param.required ? 'required' : ''}
                            class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 outline-none transition">
                            ${param.options.map(opt => `<option value="${opt.value}" ${opt.value === param.default ? 'selected' : ''}>${opt.label}</option>`).join('')}
                        </select>
                    `;
                } else if (param.type === 'boolean') {
                    inputHtml = `
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="param-${param.name}" class="sr-only peer" ${param.default ? 'checked' : ''}>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-anthropic-600"></div>
                        </label>
                    `;
                } else if (param.type === 'number') {
                    inputHtml = `
                        <input type="number" id="param-${param.name}" value="${param.default || ''}"
                            placeholder="${param.placeholder || ''}" ${param.required ? 'required' : ''}
                            class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 outline-none transition">
                    `;
                } else {
                    inputHtml = `
                        <input type="text" id="param-${param.name}" value="${param.default || ''}"
                            placeholder="${param.placeholder || ''}" ${param.required ? 'required' : ''}
                            class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 outline-none transition">
                    `;
                }

                return `
                    <div>
                        <label class="block text-sm font-medium mb-2">${param.label}</label>
                        ${inputHtml}
                        ${param.description ? `<p class="text-xs text-gray-500 mt-1">${param.description}</p>` : ''}
                    </div>
                `;
            }).join('');
        }

        function backToApplications() {
            document.getElementById('applications-step-1').classList.remove('hidden');
            document.getElementById('applications-step-2').classList.add('hidden');
            document.getElementById('applications-step-3').classList.add('hidden');
            document.getElementById('applications-step-4').classList.add('hidden');
            selectedTemplate = null;

            // Close WebSocket if open
            if (deploymentWebSocket) {
                deploymentWebSocket.close();
                deploymentWebSocket = null;
            }

            // Reload deployments list
            loadApplicationDeployments();
        }

        async function submitTemplateDeployment(event) {
            event.preventDefault();

            if (!selectedTemplate) {
                toastManager.error('Error', 'No template selected');
                return;
            }

            const name = document.getElementById('template-name').value.trim();

            if (!name) {
                toastManager.warning('Required Field', 'Please enter a deployment name');
                return;
            }

            // Collect parameters
            const parameters = {};
            for (const param of selectedTemplate.parameters) {
                const element = document.getElementById(`param-${param.name}`);
                if (element) {
                    if (param.type === 'boolean') {
                        parameters[param.name] = element.checked;
                    } else if (param.type === 'number') {
                        parameters[param.name] = parseInt(element.value) || param.default;
                    } else {
                        parameters[param.name] = element.value || param.default;
                    }
                }
            }

            // Disable submit button
            const submitBtn = document.getElementById('template-deploy-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '‚è≥ Starting deployment...';

            try {
                const response = await fetch(API_BASE + '/api/templates/deploy', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        template_id: selectedTemplate.id,
                        name: name,
                        parameters: parameters
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || 'Deployment failed');
                }

                currentDeploymentId = data.deployment_id;

                // Show progress step
                showDeploymentProgress(data.deployment_id);

                // Connect to WebSocket for progress
                connectDeploymentWebSocket(data.deployment_id);

                toastManager.success('Deployment Started', 'Connecting to deployment progress stream...');

            } catch (error) {
                console.error('Deployment error:', error);
                toastManager.error('Deployment Failed', error.message);
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'üöÄ Deploy Template';
            }
        }

        function showDeploymentProgress(deploymentId) {
            document.getElementById('applications-step-2').classList.add('hidden');
            document.getElementById('applications-step-3').classList.remove('hidden');

            // Reset progress UI
            document.getElementById('deployment-progress-bar').style.width = '0%';
            document.getElementById('deployment-progress-percent').textContent = '0%';
            document.getElementById('deployment-progress-title').textContent = 'Deploying...';
            document.getElementById('deployment-progress-status').textContent = 'Preparing deployment';
            document.getElementById('deployment-log').innerHTML = '<p class="text-gray-500">Connecting to deployment stream...</p>';
        }

        function connectDeploymentWebSocket(deploymentId) {
            const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${wsProtocol}//${window.location.host}/ws/deployments/${deploymentId}`;

            deploymentWebSocket = new WebSocket(wsUrl);

            deploymentWebSocket.onopen = () => {
                console.log('WebSocket connected');
                addDeploymentLog('Connected to deployment stream', 'info');
            };

            deploymentWebSocket.onmessage = (event) => {
                const data = JSON.parse(event.data);

                if (data.type === 'heartbeat') return;

                // Update progress
                if (data.progress !== null && data.progress !== undefined) {
                    document.getElementById('deployment-progress-bar').style.width = `${data.progress}%`;
                    document.getElementById('deployment-progress-percent').textContent = `${data.progress}%`;
                }

                // Update status text
                if (data.message) {
                    document.getElementById('deployment-progress-status').textContent = data.message;
                    addDeploymentLog(data.message, data.status || 'info');
                }

                // Check for completion
                if (data.status === 'running') {
                    showDeploymentComplete(deploymentId);
                } else if (data.status === 'failed') {
                    showDeploymentFailed(data.message);
                }
            };

            deploymentWebSocket.onerror = (error) => {
                console.error('WebSocket error:', error);
                addDeploymentLog('WebSocket connection error', 'error');
            };

            deploymentWebSocket.onclose = () => {
                console.log('WebSocket closed');
            };
        }

        function addDeploymentLog(message, type = 'info') {
            const logContainer = document.getElementById('deployment-log');
            const timestamp = new Date().toLocaleTimeString();

            const colorClass = {
                'info': 'text-gray-300',
                'success': 'text-green-400',
                'error': 'text-red-400',
                'warning': 'text-yellow-400',
                'predeployment': 'text-blue-400',
                'deploying': 'text-purple-400',
                'running': 'text-green-400',
                'failed': 'text-red-400'
            }[type] || 'text-gray-300';

            const logEntry = document.createElement('p');
            logEntry.className = colorClass;
            logEntry.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> ${message}`;
            logContainer.appendChild(logEntry);

            // Auto-scroll to bottom
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        async function showDeploymentComplete(deploymentId) {
            document.getElementById('applications-step-3').classList.add('hidden');
            document.getElementById('applications-step-4').classList.remove('hidden');

            // Fetch deployment details
            try {
                const response = await fetch(API_BASE + `/api/templates/deployments/${deploymentId}`);
                const deployment = await response.json();

                document.getElementById('deployment-complete-name').textContent = `${deployment.template_name} - ${deployment.name}`;
                document.getElementById('deployment-access-url').textContent = deployment.access_url;
                document.getElementById('deployment-open-link').href = deployment.access_url;

                // Show access type specific info with credentials/instructions
                const accessInfo = document.getElementById('deployment-access-info');
                let infoHtml = '';

                // Show instructions if available
                if (deployment.instructions) {
                    infoHtml += `
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <p class="text-xs text-blue-600 font-medium mb-1">üìù Access Info</p>
                            <p class="text-sm text-blue-800">${deployment.instructions}</p>
                        </div>
                    `;
                }

                // Show credentials prominently if available
                if (deployment.credentials) {
                    if (deployment.credentials.token) {
                        infoHtml += `
                            <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                                <p class="text-xs text-green-600 font-medium mb-1">üîë Authentication Token</p>
                                <p class="text-sm text-green-800 font-mono break-all">${deployment.credentials.token}</p>
                            </div>
                        `;
                    }
                    if (deployment.credentials.username || deployment.credentials.password) {
                        infoHtml += `
                            <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
                                <p class="text-sm text-yellow-800 font-medium">üîê Login credentials:</p>
                                ${deployment.credentials.username ? `<p class="text-lg text-yellow-900 font-mono mt-1"><span class="text-yellow-700">User:</span> <strong>${deployment.credentials.username}</strong></p>` : ''}
                                ${deployment.credentials.password ? `<p class="text-lg text-yellow-900 font-mono"><span class="text-yellow-700">Pass:</span> <strong>${deployment.credentials.password}</strong></p>` : ''}
                            </div>
                        `;
                    }
                }

                accessInfo.innerHTML = infoHtml;

            } catch (error) {
                console.error('Error fetching deployment details:', error);
            }

            // Close WebSocket
            if (deploymentWebSocket) {
                deploymentWebSocket.close();
                deploymentWebSocket = null;
            }
        }

        function showDeploymentFailed(errorMessage) {
            document.getElementById('deployment-progress-icon').textContent = '‚ùå';
            document.getElementById('deployment-progress-title').textContent = 'Deployment Failed';
            document.getElementById('deployment-progress-status').textContent = errorMessage || 'An error occurred during deployment';

            // Close WebSocket
            if (deploymentWebSocket) {
                deploymentWebSocket.close();
                deploymentWebSocket = null;
            }
        }

        function copyDeploymentUrl() {
            const url = document.getElementById('deployment-access-url').textContent;
            navigator.clipboard.writeText(url);
            toastManager.success('Copied!', 'URL copied to clipboard', { duration: 2000 });
        }

        async function loadApplicationDeployments() {
            try {
                const response = await fetch(API_BASE + '/api/templates/deployments');
                const data = await response.json();
                allDeployments = data.deployments || [];

                // Apply current filter
                const filter = document.getElementById('deployment-status-filter')?.value || 'all';
                filterDeploymentsByStatus(filter);
            } catch (error) {
                console.error('Error loading template deployments:', error);
            }
        }

        function renderApplicationDeployments(deployments) {
            const container = document.getElementById('template-deployments-list');

            // Only show running deployments
            const runningDeployments = deployments ? deployments.filter(d => d.status === 'running') : [];

            if (runningDeployments.length === 0) {
                container.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">No active deployments. Deploy an application to get started.</p>';
                return;
            }

            container.innerHTML = runningDeployments.map(d => createTemplateDeploymentCard(d)).join('');
        }

        function createTemplateDeploymentCard(deployment) {
            // Build connection string based on access type
            let connectionInfo = '';
            if (deployment.access_type === 'game') {
                connectionInfo = `<p class="font-mono text-sm text-gray-700">${deployment.host}:${deployment.port}</p>`;
            } else {
                connectionInfo = `<p class="font-mono text-sm text-gray-700 truncate">${deployment.access_url}</p>`;
            }

            return `
                <div class="card bg-white rounded-xl p-5 border border-gray-200 shadow-sm hover:shadow-md transition-shadow">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
                                <span class="text-xl">${deployment.icon || 'üì¶'}</span>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">${deployment.template_name}</h4>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                    <span class="text-xs text-green-600 font-medium">Running</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Connection Info -->
                    <div class="bg-gray-50 rounded-lg p-3 mb-3">
                        ${connectionInfo}
                        ${deployment.credentials ? `
                            <p class="text-xs text-gray-500 mt-1">
                                Login: <span class="font-mono font-medium text-gray-700">${deployment.credentials.username || ''} / ${deployment.credentials.password || deployment.credentials.token || ''}</span>
                            </p>
                        ` : ''}
                    </div>

                    <!-- Actions -->
                    <div class="flex items-center gap-2">
                        <a href="${deployment.access_url}" target="_blank" class="flex-1 px-4 py-2 bg-anthropic-600 hover:bg-anthropic-700 text-white rounded-lg text-sm font-medium transition text-center">
                            Launch
                        </a>
                        <button onclick="copyToClipboard('${deployment.access_type === 'game' ? deployment.host + ':' + deployment.port : deployment.access_url}')" class="p-2 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg transition" title="Copy URL">
                            üìã
                        </button>
                        <button onclick="stopTemplateDeployment('${deployment.id}', '${deployment.template_name}')" class="p-2 bg-red-50 hover:bg-red-100 text-red-600 rounded-lg transition" title="Stop">
                            ‚èπ
                        </button>
                    </div>
                </div>
            `;
        }

        // ============================================================================
        // DEPLOYMENT FILTERING & SYNC
        // ============================================================================
        let allDeployments = [];

        function filterDeploymentsByStatus(status) {
            if (status === 'all') {
                renderApplicationDeployments(allDeployments);
            } else {
                const filtered = allDeployments.filter(d => d.status === status);
                renderApplicationDeployments(filtered);
            }
        }

        async function syncDeploymentStatuses() {
            try {
                toastManager.info('Syncing...', 'Checking container statuses on server');

                const response = await fetch(API_BASE + '/api/templates/deployments/sync', {
                    method: 'POST'
                });
                const result = await response.json();

                if (result.success) {
                    toastManager.success('Synced', `Updated ${result.updated} deployment(s)`);
                    loadApplicationDeployments();
                } else {
                    throw new Error(result.detail || 'Sync failed');
                }
            } catch (error) {
                console.error('Error syncing:', error);
                toastManager.error('Sync Failed', error.message);
            }
        }

        // ============================================================================
        // STOP & CLEANUP DEPLOYMENT
        // ============================================================================
        async function stopTemplateDeployment(deploymentId, deploymentName) {
            if (!confirm(`Stop and remove "${deploymentName}"?\n\nThis will stop the container and clean up all resources.`)) {
                return;
            }

            try {
                toastManager.info('Stopping...', 'Stopping and cleaning up deployment');

                const response = await fetch(API_BASE + `/api/templates/deployments/${deploymentId}?cleanup=true`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    toastManager.success('Stopped', result.message || 'Deployment stopped and removed');
                    // Refresh the deployments list
                    loadApplicationDeployments();
                } else {
                    throw new Error(result.detail || 'Failed to stop deployment');
                }
            } catch (error) {
                console.error('Error stopping deployment:', error);
                toastManager.error('Error', error.message || 'Failed to stop deployment');
            }
        }

        async function stopCurrentDeployment() {
            if (!currentDeploymentId) {
                toastManager.error('Error', 'No active deployment to stop');
                return;
            }

            if (!confirm('Stop and remove this deployment?\n\nThis will stop the container and clean up all resources.')) {
                return;
            }

            try {
                toastManager.info('Stopping...', 'Stopping and cleaning up deployment');

                const response = await fetch(API_BASE + `/api/templates/deployments/${currentDeploymentId}?cleanup=true`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    toastManager.success('Stopped', result.message || 'Deployment stopped and removed');
                    // Go back to template gallery
                    backToApplications();
                } else {
                    throw new Error(result.detail || 'Failed to stop deployment');
                }
            } catch (error) {
                console.error('Error stopping deployment:', error);
                toastManager.error('Error', error.message || 'Failed to stop deployment');
            }
        }

        // ============================================================================
        // UTILITIES
        // ============================================================================
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text);
            toastManager.success('Copied!', 'Copied to clipboard.', {duration: 2000});
        }

        function formatNumber(num) {
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // ============================================================================
        // ANALYTICS
        // ============================================================================
        async function loadAnalytics() {
            try {
                const response = await fetch(API_BASE + '/api/usage');
                const data = await response.json();

                // Update summary cards
                document.getElementById('analytics-total').textContent = formatNumber(data.total_requests || 0);
                document.getElementById('analytics-this-month').textContent = formatNumber(data.this_month || 0);
                document.getElementById('analytics-last-month').textContent = formatNumber(data.last_month || 0);

                // Render chart
                renderUsageChart(data.daily_data || []);

                // Render key usage
                renderKeyUsage(data.key_usage || []);

                // Render deployment usage
                renderDeploymentUsage(data.deployment_usage || {});
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        function renderUsageChart(dailyData) {
            const container = document.getElementById('usage-chart');

            if (!dailyData || dailyData.length === 0) {
                container.innerHTML = '<p class="text-gray-600 w-full text-center">No usage data yet. Make some API requests to see analytics.</p>';
                return;
            }

            // Find max for scaling
            const maxRequests = Math.max(...dailyData.map(d => d.requests), 1);

            // Generate chart bars
            const bars = dailyData.map((day, index) => {
                const height = (day.requests / maxRequests) * 100;
                const date = new Date(day.date);
                const dayLabel = date.getDate();
                const isToday = day.date === new Date().toISOString().split('T')[0];

                return `
                    <div class="flex flex-col items-center flex-1 min-w-0 group">
                        <div class="relative w-full flex justify-center mb-1">
                            <div class="absolute -top-8 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap z-10">
                                ${day.date}: ${day.requests} requests
                            </div>
                        </div>
                        <div class="w-full ${isToday ? 'bg-anthropic-600' : 'bg-anthropic-300'} rounded-t transition-all hover:bg-anthropic-500" style="height: ${Math.max(height, 2)}%"></div>
                        ${index % 5 === 0 ? `<span class="text-xs text-gray-500 mt-1">${dayLabel}</span>` : '<span class="text-xs text-transparent mt-1">.</span>'}
                    </div>
                `;
            }).join('');

            container.innerHTML = bars;
        }

        function renderKeyUsage(keyUsage) {
            const container = document.getElementById('key-usage-list');

            if (!keyUsage || keyUsage.length === 0) {
                container.innerHTML = '<p class="text-gray-600">No API keys created yet.</p>';
                return;
            }

            const totalRequests = keyUsage.reduce((sum, k) => sum + (k.total_requests || 0), 0) || 1;

            const items = keyUsage.map(key => {
                const percentage = ((key.total_requests || 0) / totalRequests) * 100;
                const lastUsed = key.last_used ? new Date(key.last_used).toLocaleString() : 'Never';

                return `
                    <div class="flex items-center space-x-4">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-medium">${key.name}</span>
                                <span class="text-sm text-gray-600">${formatNumber(key.total_requests || 0)} requests</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-anthropic-600 h-2 rounded-full transition-all" style="width: ${percentage}%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Last used: ${lastUsed}</p>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = items;
        }

        function renderDeploymentUsage(deploymentUsage) {
            const container = document.getElementById('deployment-usage-list');

            const entries = Object.entries(deploymentUsage);
            if (entries.length === 0) {
                container.innerHTML = '<p class="text-gray-600">No deployment usage data yet.</p>';
                return;
            }

            const totalRequests = entries.reduce((sum, [_, count]) => sum + count, 0) || 1;

            const items = entries.map(([deploymentId, count]) => {
                const percentage = (count / totalRequests) * 100;

                return `
                    <div class="flex items-center space-x-4">
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-medium font-mono">${deploymentId}</span>
                                <span class="text-sm text-gray-600">${formatNumber(count)} requests</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-green-500 h-2 rounded-full transition-all" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = items;
        }

        // ============================================================================
        // SETTINGS
        // ============================================================================
        async function loadSettings() {
            try {
                const response = await fetch(API_BASE + '/api/settings');
                const data = await response.json();

                // Account info
                document.getElementById('settings-name').value = data.account?.name || '';
                document.getElementById('settings-email').value = data.account?.email || '';
                document.getElementById('settings-company').value = data.account?.company || '';
                document.getElementById('account-plan-badge').textContent = data.account?.plan || 'Free';

                // Billing info
                document.getElementById('billing-current').textContent = '$' + (data.billing?.current_month || 0).toFixed(2);
                document.getElementById('billing-last').textContent = '$' + (data.billing?.last_month || 0).toFixed(2);
                document.getElementById('billing-method').textContent = data.billing?.payment_method || 'No payment method';

                // Notification preferences
                document.getElementById('notif-email').checked = data.notifications?.email_notifications ?? true;
                document.getElementById('notif-started').checked = data.notifications?.deployment_started ?? true;
                document.getElementById('notif-stopped').checked = data.notifications?.deployment_stopped ?? true;
                document.getElementById('notif-failed').checked = data.notifications?.deployment_failed ?? true;
                document.getElementById('notif-usage').checked = data.notifications?.usage_alerts ?? true;
                document.getElementById('notif-weekly').checked = data.notifications?.weekly_summary ?? false;

                // Webhooks
                loadWebhooks(data.webhooks || []);
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        async function saveAccountSettings(event) {
            event.preventDefault();

            const name = document.getElementById('settings-name').value.trim();
            const email = document.getElementById('settings-email').value.trim();
            const company = document.getElementById('settings-company').value.trim();

            if (!email) {
                toastManager.warning('Email Required', 'Please enter your email address.');
                return;
            }

            try {
                const response = await fetch(API_BASE + '/api/settings/account', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, company })
                });

                const data = await response.json();
                if (data.success) {
                    toastManager.success('Settings Saved', 'Your account settings have been updated.');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                toastManager.error('Save Failed', 'Could not save your settings. Please try again.');
            }
        }

        async function updateNotification(key, value) {
            try {
                const body = {};
                body[key] = value;

                const response = await fetch(API_BASE + '/api/settings/notifications', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                if (data.success) {
                    toastManager.success('Preference Updated', `Notification preference saved.`, { duration: 2000 });
                }
            } catch (error) {
                console.error('Error updating notification:', error);
                toastManager.error('Update Failed', 'Could not update preference.');
            }
        }

        // ============================================================================
        // WEBHOOKS
        // ============================================================================
        function loadWebhooks(webhooks) {
            const container = document.getElementById('webhooks-list');

            if (!webhooks || webhooks.length === 0) {
                container.innerHTML = '<p class="text-gray-600">No webhooks configured. Add a webhook to receive event notifications.</p>';
                return;
            }

            container.innerHTML = webhooks.map(webhook => createWebhookCard(webhook)).join('');
        }

        function createWebhookCard(webhook) {
            const statusClass = webhook.active ? 'bg-green-500' : 'bg-gray-400';
            const statusText = webhook.active ? 'Active' : 'Inactive';

            return `
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 ${statusClass} rounded-full"></div>
                            <span class="font-medium text-gray-900">${webhook.name}</span>
                            <span class="text-xs text-gray-500">${statusText}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="toggleWebhook('${webhook.id}')" class="text-sm text-anthropic-600 hover:text-anthropic-700">
                                ${webhook.active ? 'Disable' : 'Enable'}
                            </button>
                            <button onclick="deleteWebhook('${webhook.id}')" class="text-sm text-red-600 hover:text-red-700">Delete</button>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div>
                            <p class="text-xs text-gray-700 mb-1">URL</p>
                            <code class="text-xs bg-white border border-gray-200 px-2 py-1 rounded block overflow-x-auto">${webhook.url}</code>
                        </div>
                        <div>
                            <p class="text-xs text-gray-700 mb-1">Events</p>
                            <div class="flex flex-wrap gap-1">
                                ${webhook.events.map(e => `<span class="px-2 py-0.5 bg-anthropic-100 text-anthropic-700 text-xs rounded">${e}</span>`).join('')}
                            </div>
                        </div>
                        ${webhook.last_triggered ? `<p class="text-xs text-gray-500">Last triggered: ${new Date(webhook.last_triggered).toLocaleString()}</p>` : ''}
                    </div>
                </div>
            `;
        }

        function showAddWebhookModal() {
            document.getElementById('webhook-modal').classList.remove('hidden');
        }

        function closeWebhookModal() {
            document.getElementById('webhook-modal').classList.add('hidden');
            document.getElementById('webhook-form').reset();
        }

        async function createWebhook(event) {
            event.preventDefault();

            const name = document.getElementById('webhook-name').value.trim();
            const url = document.getElementById('webhook-url').value.trim();

            // Get selected events
            const events = [];
            document.querySelectorAll('input[name="webhook-events"]:checked').forEach(cb => {
                events.push(cb.value);
            });

            if (!url) {
                toastManager.warning('URL Required', 'Please enter a webhook URL.');
                return;
            }

            if (events.length === 0) {
                toastManager.warning('Events Required', 'Please select at least one event.');
                return;
            }

            try {
                const response = await fetch(API_BASE + '/api/settings/webhooks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, url, events })
                });

                const data = await response.json();
                if (data.success) {
                    toastManager.success('Webhook Created', 'Your webhook has been added.');
                    closeWebhookModal();
                    loadSettings();
                }
            } catch (error) {
                console.error('Error creating webhook:', error);
                toastManager.error('Creation Failed', 'Could not create webhook.');
            }
        }

        async function toggleWebhook(webhookId) {
            try {
                const response = await fetch(API_BASE + `/api/settings/webhooks/${webhookId}/toggle`, {
                    method: 'PUT'
                });

                const data = await response.json();
                if (data.success) {
                    toastManager.success('Webhook Updated', `Webhook is now ${data.active ? 'active' : 'inactive'}.`, { duration: 2000 });
                    loadSettings();
                }
            } catch (error) {
                console.error('Error toggling webhook:', error);
                toastManager.error('Update Failed', 'Could not update webhook.');
            }
        }

        async function deleteWebhook(webhookId) {
            if (!confirm('Are you sure you want to delete this webhook?')) return;

            try {
                const response = await fetch(API_BASE + `/api/settings/webhooks/${webhookId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                if (data.success) {
                    toastManager.success('Webhook Deleted', 'The webhook has been removed.');
                    loadSettings();
                }
            } catch (error) {
                console.error('Error deleting webhook:', error);
                toastManager.error('Delete Failed', 'Could not delete webhook.');
            }
        }

        // ============================================================================
        // METRICS MODAL
        // ============================================================================
        let metricsRefreshInterval = null;

        async function showMetrics(deploymentId, deploymentName) {
            document.getElementById('metrics-modal').classList.remove('hidden');
            document.getElementById('metrics-deployment-name').textContent = deploymentName;
            document.getElementById('metrics-deployment-id').dataset.id = deploymentId;

            // Load initial metrics
            await refreshMetrics(deploymentId);

            // Set up auto-refresh every 5 seconds
            metricsRefreshInterval = setInterval(() => refreshMetrics(deploymentId), 5000);
        }

        function closeMetricsModal() {
            document.getElementById('metrics-modal').classList.add('hidden');
            if (metricsRefreshInterval) {
                clearInterval(metricsRefreshInterval);
                metricsRefreshInterval = null;
            }
        }

        async function refreshMetrics(deploymentId) {
            try {
                const response = await fetch(API_BASE + `/api/deployments/${deploymentId}/metrics`);
                const metrics = await response.json();

                // Update all metric displays
                document.getElementById('metric-cpu').textContent = metrics.cpu_percent + '%';
                document.getElementById('metric-memory').textContent = metrics.memory_percent + '%';
                document.getElementById('metric-gpu-util').textContent = metrics.gpu_utilization + '%';
                document.getElementById('metric-gpu-mem').textContent = Math.round(metrics.gpu_memory_used_mb / 1024) + ' / ' + Math.round(metrics.gpu_memory_total_mb / 1024) + ' GB';
                document.getElementById('metric-network-rx').textContent = metrics.network_rx_mbps + ' Mbps';
                document.getElementById('metric-network-tx').textContent = metrics.network_tx_mbps + ' Mbps';
                document.getElementById('metric-rpm').textContent = metrics.requests_per_minute;
                document.getElementById('metric-latency-avg').textContent = metrics.avg_latency_ms + ' ms';
                document.getElementById('metric-latency-p95').textContent = metrics.p95_latency_ms + ' ms';
                document.getElementById('metric-latency-p99').textContent = metrics.p99_latency_ms + ' ms';
                document.getElementById('metric-error-rate').textContent = metrics.error_rate_percent + '%';
                document.getElementById('metric-success-1h').textContent = formatNumber(metrics.success_count_1h);
                document.getElementById('metric-errors-1h').textContent = metrics.error_count_1h;

                // Format uptime
                const hours = Math.floor(metrics.uptime_seconds / 3600);
                const days = Math.floor(hours / 24);
                document.getElementById('metric-uptime').textContent = days > 0 ? `${days}d ${hours % 24}h` : `${hours}h`;

                // Update status indicator
                const statusEl = document.getElementById('metric-status');
                statusEl.textContent = metrics.status;
                statusEl.className = metrics.status === 'healthy'
                    ? 'px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium'
                    : 'px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm font-medium';

                // Update progress bars
                document.getElementById('cpu-bar').style.width = metrics.cpu_percent + '%';
                document.getElementById('memory-bar').style.width = metrics.memory_percent + '%';
                document.getElementById('gpu-bar').style.width = metrics.gpu_utilization + '%';

                document.getElementById('metric-timestamp').textContent = 'Updated: ' + new Date().toLocaleTimeString();
            } catch (error) {
                console.error('Error refreshing metrics:', error);
            }
        }

        // ============================================================================
        // USAGE LIMITS
        // ============================================================================
        async function loadLimits() {
            try {
                const response = await fetch(API_BASE + '/api/limits');
                const data = await response.json();

                document.getElementById('limits-enabled').checked = data.limits.enabled;
                document.getElementById('limit-rpm').value = data.limits.api_requests_per_minute;
                document.getElementById('limit-rpd').value = data.limits.api_requests_per_day;
                document.getElementById('limit-deployments').value = data.limits.max_concurrent_deployments;
                document.getElementById('limit-keys').value = data.limits.max_api_keys;
                document.getElementById('limit-cost-alert').value = data.limits.cost_alert_threshold;
                document.getElementById('limit-auto-stop').value = data.limits.auto_stop_threshold;
            } catch (error) {
                console.error('Error loading limits:', error);
            }
        }

        async function saveLimits() {
            try {
                const limits = {
                    enabled: document.getElementById('limits-enabled').checked,
                    api_requests_per_minute: parseInt(document.getElementById('limit-rpm').value) || 60,
                    api_requests_per_day: parseInt(document.getElementById('limit-rpd').value) || 10000,
                    max_concurrent_deployments: parseInt(document.getElementById('limit-deployments').value) || 5,
                    max_api_keys: parseInt(document.getElementById('limit-keys').value) || 10,
                    cost_alert_threshold: parseFloat(document.getElementById('limit-cost-alert').value) || 100,
                    auto_stop_threshold: parseFloat(document.getElementById('limit-auto-stop').value) || 500
                };

                const response = await fetch(API_BASE + '/api/limits', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(limits)
                });

                const data = await response.json();
                if (data.success) {
                    toastManager.success('Limits Saved', 'Usage limits have been updated.');
                }
            } catch (error) {
                console.error('Error saving limits:', error);
                toastManager.error('Save Failed', 'Could not save usage limits.');
            }
        }

        async function toggleLimits(enabled) {
            try {
                const response = await fetch(API_BASE + '/api/limits', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled })
                });

                const data = await response.json();
                if (data.success) {
                    toastManager.success('Limits ' + (enabled ? 'Enabled' : 'Disabled'),
                        enabled ? 'Usage limits are now active.' : 'Usage limits have been disabled.',
                        { duration: 2000 });
                }
            } catch (error) {
                console.error('Error toggling limits:', error);
            }
        }

        // ============================================================================
        // DANGER ZONE
        // ============================================================================
        async function dangerResetUsage() {
            if (!confirm('Are you sure you want to reset ALL usage statistics? This cannot be undone.')) return;
            if (!confirm('This will permanently delete all analytics data. Type "RESET" to confirm:')) return;

            const confirmation = prompt('Type "RESET" to confirm:');
            if (confirmation !== 'RESET') {
                toastManager.info('Cancelled', 'Reset operation cancelled.');
                return;
            }

            try {
                const response = await fetch(API_BASE + '/api/danger/reset-usage', { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    toastManager.success('Usage Reset', data.message);
                    loadAnalytics();
                    loadStats();
                } else {
                    toastManager.error('Reset Failed', data.message);
                }
            } catch (error) {
                console.error('Error resetting usage:', error);
                toastManager.error('Reset Failed', 'Could not reset usage statistics.');
            }
        }

        async function dangerRevokeAllKeys() {
            if (!confirm('Are you sure you want to revoke ALL API keys? This cannot be undone.')) return;

            const confirmation = prompt('Type "REVOKE ALL" to confirm:');
            if (confirmation !== 'REVOKE ALL') {
                toastManager.info('Cancelled', 'Revocation cancelled.');
                return;
            }

            try {
                const response = await fetch(API_BASE + '/api/danger/revoke-all-keys', { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    toastManager.success('Keys Revoked', data.message);
                    loadAPIKeys();
                } else {
                    toastManager.error('Revocation Failed', data.message);
                }
            } catch (error) {
                console.error('Error revoking keys:', error);
                toastManager.error('Revocation Failed', 'Could not revoke API keys.');
            }
        }

        async function dangerStopAllDeployments() {
            if (!confirm('Are you sure you want to STOP ALL deployments? This will immediately terminate all running instances.')) return;

            const confirmation = prompt('Type "STOP ALL" to confirm:');
            if (confirmation !== 'STOP ALL') {
                toastManager.info('Cancelled', 'Stop operation cancelled.');
                return;
            }

            try {
                const response = await fetch(API_BASE + '/api/danger/stop-all-deployments', { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    toastManager.success('Deployments Stopped', data.message);
                    loadDeployments();
                    loadStats();
                } else {
                    toastManager.error('Stop Failed', data.message);
                }
            } catch (error) {
                console.error('Error stopping deployments:', error);
                toastManager.error('Stop Failed', 'Could not stop deployments.');
            }
        }

        // ============================================================================
        // COST TRACKING
        // ============================================================================
        async function loadCostBreakdown() {
            try {
                const response = await fetch(API_BASE + '/api/costs');
                const data = await response.json();

                // Update billing section with real cost data
                document.getElementById('billing-current').textContent = '$' + data.current_month.toFixed(2);
                document.getElementById('billing-last').textContent = '$' + data.last_month.toFixed(2);

                // If we have cost projection info, show it
                if (data.projected_monthly > 0) {
                    const projectionEl = document.getElementById('billing-projection');
                    if (projectionEl) {
                        projectionEl.textContent = 'Projected: $' + data.projected_monthly.toFixed(2) + '/mo';
                    }
                }
            } catch (error) {
                console.error('Error loading cost breakdown:', error);
            }
        }

        // ============================================================================
        // SIMULATE API USAGE (for testing)
        // ============================================================================
        async function simulateAPIUsage(keyId, deploymentId = null) {
            try {
                let url = API_BASE + `/api/usage/record?key_id=${keyId}`;
                if (deploymentId) {
                    url += `&deployment_id=${deploymentId}`;
                }

                const response = await fetch(url, { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    toastManager.success('Usage Recorded', 'API request recorded successfully.', { duration: 2000 });
                    loadAnalytics();
                    loadStats();
                }
            } catch (error) {
                console.error('Error simulating usage:', error);
            }
        }

        // ============================================================================
        // ENHANCED SETTINGS LOADER
        // ============================================================================
        const originalLoadSettings = loadSettings;
        loadSettings = async function() {
            await originalLoadSettings();
            await loadLimits();
            await loadCostBreakdown();
        };

        // ============================================================================
        // INIT
        // ============================================================================
        // Dashboard collapse state
        let dashboardCollapsed = false;

        function toggleDashboard() {
            dashboardCollapsed = !dashboardCollapsed;
            const stats = document.getElementById('dashboard-stats');
            const chevron = document.getElementById('dashboard-chevron');

            if (dashboardCollapsed) {
                stats.style.maxHeight = '0';
                stats.style.marginBottom = '0';
                stats.style.opacity = '0';
                chevron.classList.add('-rotate-90');
            } else {
                stats.style.maxHeight = '500px';
                stats.style.marginBottom = '2rem';
                stats.style.opacity = '1';
                chevron.classList.remove('-rotate-90');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadTemplates();
            loadApplicationDeployments();

            // Refresh stats every 30 seconds
            setInterval(loadStats, 30000);

            // Load metrics for deployments after they're loaded
            setTimeout(async () => {
                try {
                    const response = await fetch(API_BASE + '/api/deployments');
                    const data = await response.json();
                    if (data.deployments) {
                        data.deployments.forEach(d => loadQuickMetrics(d.id));
                    }
                } catch (e) {}
            }, 1000);

            // Refresh deployment metrics every 30 seconds
            setInterval(async () => {
                try {
                    const response = await fetch(API_BASE + '/api/deployments');
                    const data = await response.json();
                    if (data.deployments) {
                        data.deployments.forEach(d => loadQuickMetrics(d.id));
                    }
                } catch (e) {}
            }, 30000);
        });
    </script>

    <!-- Logs Modal -->
    <div id="logs-modal" class="fixed inset-0 z-[9998] hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="closeLogsModal()"></div>

        <!-- Modal -->
        <div class="absolute inset-4 md:inset-20 bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col">
            <!-- Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900">Deployment Logs</h3>
                <button onclick="closeLogsModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Logs Content -->
            <div class="flex-1 overflow-auto p-6 bg-gray-50">
                <pre id="logs-content" class="text-sm font-mono text-gray-800 whitespace-pre-wrap"></pre>
            </div>

            <!-- Footer -->
            <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
                <button onclick="copyLogs()" class="px-4 py-2 bg-white border-2 border-gray-300 hover:bg-gray-50 rounded-lg text-sm font-medium">
                    Copy Logs
                </button>
                <button onclick="closeLogsModal()" class="px-4 py-2 bg-anthropic-600 hover:bg-anthropic-700 text-white rounded-lg text-sm font-medium">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 left-4 md:left-auto md:max-w-md z-[9999] space-y-3 pointer-events-none">
    </div>

    <!-- Webhook Modal -->
    <div id="webhook-modal" class="fixed inset-0 z-[9998] hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="closeWebhookModal()"></div>

        <!-- Modal -->
        <div class="absolute inset-4 md:inset-y-20 md:inset-x-1/4 bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[80vh]">
            <!-- Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900">Add Webhook</h3>
                <button onclick="closeWebhookModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Form -->
            <form id="webhook-form" onsubmit="createWebhook(event)" class="flex-1 overflow-auto p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Webhook Name (Optional)</label>
                    <input id="webhook-name" type="text" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="My Webhook">
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Webhook URL</label>
                    <input id="webhook-url" type="url" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="https://your-server.com/webhook" required>
                    <p class="text-xs text-gray-600 mt-1">We'll send a POST request to this URL when events occur</p>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-3">Events to Subscribe</label>
                    <div class="space-y-3">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" name="webhook-events" value="deployment.started" class="w-4 h-4 text-anthropic-600 bg-white border-gray-300 rounded focus:ring-anthropic-600">
                            <div>
                                <p class="text-sm font-medium">deployment.started</p>
                                <p class="text-xs text-gray-600">When a new deployment starts</p>
                            </div>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" name="webhook-events" value="deployment.stopped" class="w-4 h-4 text-anthropic-600 bg-white border-gray-300 rounded focus:ring-anthropic-600">
                            <div>
                                <p class="text-sm font-medium">deployment.stopped</p>
                                <p class="text-xs text-gray-600">When a deployment stops</p>
                            </div>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" name="webhook-events" value="deployment.failed" class="w-4 h-4 text-anthropic-600 bg-white border-gray-300 rounded focus:ring-anthropic-600">
                            <div>
                                <p class="text-sm font-medium">deployment.failed</p>
                                <p class="text-xs text-gray-600">When a deployment fails</p>
                            </div>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" name="webhook-events" value="api.request" class="w-4 h-4 text-anthropic-600 bg-white border-gray-300 rounded focus:ring-anthropic-600">
                            <div>
                                <p class="text-sm font-medium">api.request</p>
                                <p class="text-xs text-gray-600">When an API request is made (high volume)</p>
                            </div>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" name="webhook-events" value="usage.threshold" class="w-4 h-4 text-anthropic-600 bg-white border-gray-300 rounded focus:ring-anthropic-600">
                            <div>
                                <p class="text-sm font-medium">usage.threshold</p>
                                <p class="text-xs text-gray-600">When usage approaches limits</p>
                            </div>
                        </label>
                    </div>
                </div>
            </form>

            <!-- Footer -->
            <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
                <button type="button" onclick="closeWebhookModal()" class="px-4 py-2 bg-white border-2 border-gray-300 hover:bg-gray-50 rounded-lg text-sm font-medium">
                    Cancel
                </button>
                <button type="submit" form="webhook-form" class="px-4 py-2 bg-gradient-to-r from-anthropic-600 to-anthropic-700 hover:from-anthropic-700 hover:to-anthropic-800 text-white rounded-lg text-sm font-medium">
                    Create Webhook
                </button>
            </div>
        </div>
    </div>

    <!-- API Key Modal -->
    <div id="api-key-modal" class="fixed inset-0 z-[9998] hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="closeAPIKeyModal()"></div>

        <!-- Modal -->
        <div class="absolute inset-4 md:inset-y-1/4 md:inset-x-1/3 bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[400px]">
            <!-- Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900">Generate New API Key</h3>
                <button onclick="closeAPIKeyModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Form -->
            <form id="api-key-form" onsubmit="createAPIKey(event)" class="flex-1 overflow-auto p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Key Name <span class="text-red-500">*</span></label>
                    <input id="new-key-name" type="text" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition" placeholder="e.g., Production Key, Mobile App" required>
                    <p class="text-xs text-gray-600 mt-1">A descriptive name to identify this key</p>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Description (Optional)</label>
                    <textarea id="new-key-description" rows="2" class="w-full bg-white border-2 border-gray-300 rounded-lg px-4 py-2 focus:border-anthropic-600 focus:ring-2 focus:ring-anthropic-600 focus:ring-opacity-50 outline-none transition resize-none" placeholder="What will this key be used for?"></textarea>
                </div>

                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                    <p class="text-sm text-yellow-800">
                        <strong>Important:</strong> The API key will only be shown once after creation. Make sure to copy and store it securely.
                    </p>
                </div>
            </form>

            <!-- Footer -->
            <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
                <button type="button" onclick="closeAPIKeyModal()" class="px-4 py-2 bg-white border-2 border-gray-300 hover:bg-gray-50 rounded-lg text-sm font-medium">
                    Cancel
                </button>
                <button type="submit" form="api-key-form" class="px-4 py-2 bg-gradient-to-r from-anthropic-600 to-anthropic-700 hover:from-anthropic-700 hover:to-anthropic-800 text-white rounded-lg text-sm font-medium">
                    Generate Key
                </button>
            </div>
        </div>
    </div>

    <!-- Metrics Modal -->
    <div id="metrics-modal" class="fixed inset-0 z-[9998] hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="closeMetricsModal()"></div>

        <!-- Modal -->
        <div class="absolute inset-4 md:inset-10 bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col">
            <!-- Header -->
            <div class="flex items-center justify-between p-6 border-b border-gray-200">
                <div class="flex items-center space-x-4">
                    <h3 class="text-xl font-bold text-gray-900">Deployment Metrics</h3>
                    <span id="metrics-deployment-name" class="px-3 py-1 bg-anthropic-100 text-anthropic-700 rounded-full text-sm font-medium">-</span>
                    <span id="metric-status" class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">healthy</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="metric-timestamp" class="text-sm text-gray-500">Updated: --</span>
                    <button onclick="closeMetricsModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Metrics Content -->
            <div id="metrics-deployment-id" data-id="" class="flex-1 overflow-auto p-6 bg-gray-50">
                <!-- Resource Usage -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <!-- CPU -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-sm font-medium text-gray-700">CPU Usage</h4>
                            <span id="metric-cpu" class="text-2xl font-bold text-gray-900">--%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="cpu-bar" class="bg-blue-500 h-3 rounded-full transition-all" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Memory -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-sm font-medium text-gray-700">Memory Usage</h4>
                            <span id="metric-memory" class="text-2xl font-bold text-gray-900">--%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="memory-bar" class="bg-green-500 h-3 rounded-full transition-all" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- GPU -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-sm font-medium text-gray-700">GPU Utilization</h4>
                            <span id="metric-gpu-util" class="text-2xl font-bold text-gray-900">--%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="gpu-bar" class="bg-anthropic-500 h-3 rounded-full transition-all" style="width: 0%"></div>
                        </div>
                        <p id="metric-gpu-mem" class="text-xs text-gray-500 mt-2">-- / -- GB</p>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl p-4 border border-gray-200 text-center">
                        <p class="text-xs text-gray-600 mb-1">Requests/min</p>
                        <p id="metric-rpm" class="text-xl font-bold text-gray-900">--</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 border border-gray-200 text-center">
                        <p class="text-xs text-gray-600 mb-1">Avg Latency</p>
                        <p id="metric-latency-avg" class="text-xl font-bold text-gray-900">-- ms</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 border border-gray-200 text-center">
                        <p class="text-xs text-gray-600 mb-1">P95 Latency</p>
                        <p id="metric-latency-p95" class="text-xl font-bold text-yellow-600">-- ms</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 border border-gray-200 text-center">
                        <p class="text-xs text-gray-600 mb-1">P99 Latency</p>
                        <p id="metric-latency-p99" class="text-xl font-bold text-red-600">-- ms</p>
                    </div>
                </div>

                <!-- Network & Errors -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                    <div class="bg-white rounded-xl p-4 border border-gray-200 text-center">
                        <p class="text-xs text-gray-600 mb-1">Network RX</p>
                        <p id="metric-network-rx" class="text-lg font-semibold text-gray-900">-- Mbps</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 border border-gray-200 text-center">
                        <p class="text-xs text-gray-600 mb-1">Network TX</p>
                        <p id="metric-network-tx" class="text-lg font-semibold text-gray-900">-- Mbps</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 border border-gray-200 text-center">
                        <p class="text-xs text-gray-600 mb-1">Error Rate</p>
                        <p id="metric-error-rate" class="text-lg font-semibold text-red-600">--%</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 border border-gray-200 text-center">
                        <p class="text-xs text-gray-600 mb-1">Success (1h)</p>
                        <p id="metric-success-1h" class="text-lg font-semibold text-green-600">--</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 border border-gray-200 text-center">
                        <p class="text-xs text-gray-600 mb-1">Errors (1h)</p>
                        <p id="metric-errors-1h" class="text-lg font-semibold text-red-600">--</p>
                    </div>
                </div>

                <!-- Uptime -->
                <div class="bg-white rounded-xl p-6 border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-sm font-medium text-gray-700">Uptime</h4>
                            <p class="text-xs text-gray-500">Time since deployment started</p>
                        </div>
                        <span id="metric-uptime" class="text-3xl font-bold text-green-600">--</span>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="p-6 border-t border-gray-200 flex justify-between items-center">
                <p class="text-sm text-gray-500">Metrics refresh automatically every 5 seconds</p>
                <button onclick="closeMetricsModal()" class="px-4 py-2 bg-anthropic-600 hover:bg-anthropic-700 text-white rounded-lg text-sm font-medium">
                    Close
                </button>
            </div>
        </div>
    </div>
</body>
</html>
